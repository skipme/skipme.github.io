var truss_o;(function(){var k={test:"hello",test2:"world"};var j=function(n){console.log(n)};var i=[];function g(q,r,s){if(q.indexOf(".")===-1){if(s||(this.options[q]===null||typeof this.options[q]==="undefined")){this.options[q]=r}}else{var t=q.split(".");var n=this.options;for(var p=0;p<t.length-1;p++){if(t[p]===null||typeof t[p]==="undefined"){throw"The property path not well formed: "+q+" defaultval: "+r}if(typeof n[t[p]]==="undefined"){n[t[p]]={}}n=n[t[p]]}n[t[t.length-1]]=r}}function m(n,p,q){i.push({name:p,after:q,foo:n})}function c(p,n){return p+Math.floor((Math.random()*(n-p)+1))}function l(r){if(!r||"object"!==typeof r){return r}var s="function"===typeof r.pop?[]:{};var q,n;for(q in r){if(r.hasOwnProperty(q)){n=r[q];if(n&&"object"===typeof n){s[q]=l(n)}else{s[q]=n}}}return s}function a(n){var p=l(this);p.canvas=n;p.context=n.getContext("2d");e(p);delete p.create;delete p.extendModule;return p}function e(p){var n;var q=0;while(!n){n=h(p);if(!n){if(p.options.registered.length==q){throw"missed some module"}}q=p.options.registered.length}j("extended by "+i.length+" modules")}function h(r){var n=true;r.option("registered",new Array());var t=r.options.registered;for(var q=0;q<i.length;q++){if(t.indexOf(i[q].name)>=0){continue}var s=true;if(typeof i[q].after==="string"){if(t.indexOf(i[q].after)>=0){s=true}else{s=false}}else{if(typeof i[q].after==="object"){s=true;for(var p=0;p<i[q].after.length;p++){if(t.indexOf(i[q].after[p])<0){s=false;break}}}else{if(typeof i[q].after==="undefined"){s=true}}}if(s){i[q].foo(r);t.push(i[q].name);j("extended by "+i[q].name)}else{n=false}}return n}function d(){j(this.options.test+" "+this.options.test2)}function b(n){var p={};return n&&p.toString.call(n)==="[object Function]"}uuid=(function(){var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(p,u){var w=n,t=[],s=Math.random;u=u||w.length;if(p){for(var q=0;q<p;q++){t[q]=w[0|s()*u]}}else{var v;t[8]=t[13]=t[18]=t[23]="-";t[14]="4";for(var q=0;q<36;q++){if(!t[q]){v=0|s()*16;t[q]=w[(q==19)?(v&3)|8:v&15]}}}return t.join("")}})();truss_o={version:"0.1 devTool",options:k,option:g,say:d,rndm:c,extendModule:m,create:a,isFunction:b,uuid:uuid,log:j};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1000/60)}})()}());(function(){var h=10;function g(j){j.fps={};j.fps.rate=0;j.fps.now=0;j.fps.lastUpdate=(new Date)*1-1;j.addEvent("Render");j.addEvent("update");j.StopAnim=false;j.SuspendFrame=false;j.animFrame=d;j.option("animFps",30);j.animFPS=0;e(j);j.timers=[];j.CreateTimer=c;j.uselessFrames=500;j.suspendAnimation=a;j.update=i}function d(j){var k=1000/((j.fps.now=new Date)-j.fps.lastUpdate);j.fps.rate+=(k-j.fps.rate)/h;j.fps.lastUpdate=j.fps.now;if(!j.StopAnim){if(j.uselessFrames<=-5){j.suspendAnimation()}j.invokeEvent("Render");j.uselessFrames--}}function c(k,m){var j=this;var l=setInterval(function(){m.call(j)},k);this.timers.push(l)}function b(j){j.animFrame(j)}function e(j){b(j);if(!j.SuspendFrame){requestAnimFrame(function(){e(j)})}}function a(){this.SuspendFrame=true}function i(){if(this.SuspendFrame){this.SuspendFrame=false;this.uselessFrames=30;e(this);console.log("frame loop-->")}else{this.uselessFrames=30}this.invokeEvent("update")}truss_o.extendModule(g,"core.Animate",["core.Events","core.runtime"])}());(function(){function l(m){m.menu={menuList:[],displayMenuName:"",displayMenu:undefined,displayMenuOrigin:{x:0,y:0},displayMenuBounds:{mwidth:0,h:0}};m.RenderDisplayMenuText=function(n,p){j(this,n,p)};m.RenderDisplayMenuBackground=function(n){c(this,n)};m.AddDisplayMenu=k;m.ShowMenu=function(p,n,r,q){i(this,p,n,r)};m.HideMenu=g;m.processInteractionMMove=d;m.processInteractionMMdown=h}function g(){if(typeof this.menu.displayMenu==="undefined"){return}var n=this.menu.displayMenu;for(var m=0;m<n.items.length;m++){n.items[m].selected=false}this.menu.displayMenu=undefined;this.update()}function k(n,m){m.name=n;this.menu.menuList.push(m)}function a(m,n){for(var p=0;p<m.menu.menuList.length;p++){if(m.menu.menuList[p].name==n){return m.menu.menuList[p]}}return undefined}function i(n,p,m,r){var q=a(n,p);if(typeof q==="undefined"){return}n.menu.displayMenuName=p;n.menu.displayMenu=q;n.menu.displayMenuOrigin.x=m;n.menu.displayMenuOrigin.y=r;n.update()}function e(n,m){j(this,n);c(this,m)}function j(r,q,p){var u=r.menu.displayMenu;if(u){r.setLayer(q);r.SetShadow();r.context.font="8pt Verdana";r.context.textBaseline="top";r.context.textAlign="start";r.context.fillStyle="rgb(255, 255, 255)";var t=r.menu.displayMenuOrigin.x+4;var s=r.menu.displayMenuOrigin.y;for(var m=0;m<u.items.length;m++){var v=u.items[m];var n=r.context.measureText(v.text);r.menu.displayMenuBounds.mwidth=Math.max(r.menu.displayMenuBounds.mwidth,n.width+8);if(!p){r.context.fillText(v.text,t,s+=2)}r.menu.displayMenuBounds.h=10+4;s+=10+4}}}function c(q,p){q.setLayer(p);var v=q.menu.displayMenu;if(v){var s=q.menu.displayMenuOrigin.x;var r=q.menu.displayMenuOrigin.y;var t=q.menu.displayMenuBounds.mwidth;q.SetShadow();var m={w:0,h:0};for(var n=0;n<v.items.length;n++){var u=v.items[n];if(u.selected){q.context.fillStyle="rgba(255, 187, 40, 0.8)"}else{q.context.fillStyle="rgba(111, 111, 111, 0.8)"}u.x=s;u.y=r+(n*16);u.w=t>0?t:96;u.h=16;q.context.fillRect(u.x,u.y,u.w,u.h);m.h+=u.h;m.w=u.w}}}function d(r,q){if(this.menu.displayMenu){var m=false;var s=this.menu.displayMenu;for(var n=0;n<s.items.length;n++){var p=s.items[n];if(p.text[0]!="-"&&b(p.x,p.y,p.w,p.h,r,q)){if(!p.selected){m=true}p.selected=true}else{if(p.selected){m=true}p.selected=false}}if(m){this.update()}}}function h(q,t,s){if(this.menu.displayMenu){var n=false;var u=this.menu.displayMenu;var m=-1;for(var p=0;p<u.items.length;p++){var r=u.items[p];if(b(r.x,r.y,r.w,r.h,t,s)){r.selected=true;m=p}else{r.selected=false}}if(m>=0){if(u.items[m].text[0]=="-"){return true}this.HideMenu();callback=u.items[m].callback;if(typeof callback!=="undefined"&&this.isFunction(callback)){callback.call(this)}this.update();return true}}return false}function b(m,s,n,r,q,p){return(m<q&&m+n>=q&&s<p&&s+r>=p)}truss_o.extendModule(l,"view.Menu",["view.Input","view.Interface","core.Events","core.runtime"])}());(function(){var j=128;function l(m){var p={Render:c,update:d};m.addViewEngine("DemoMetaspheres",p);var n=m.runtime;n.dmeta={ovals:[],ovalRadius:j,gradient:null,dragging:{index:-1,sx:0,sy:0,cx:0,cy:0}};g(m,n.dmeta);n.dmeta.gradient=m.MetaPrepareGradient(j);m.addEventListener("mousedown",e);m.addEventListener("mouseup",a);m.addEventListener("mousemove",k)}function e(r){var t=r.pageX-this.bounds.left;var q=r.pageY-this.bounds.top;var m=this.runtime.dmeta;m.dragging.index=-1;for(var n=0;n<m.ovals.length;n++){var s=m.ovals[n].x;var p=m.ovals[n].y;if(b(s,p,32,t,q)){m.dragging.index=n;m.dragging.sx=t;m.dragging.sy=q;m.dragging.cx=t-m.ovals[n].x;m.dragging.cy=q-m.ovals[n].y;this.update();break}}}function a(n){var m=this.runtime.dmeta;m.dragging.index=-1}function k(q){var r=q.pageX-this.bounds.left;var p=q.pageY-this.bounds.top;var n=this.runtime.dmeta;if(n.dragging.index>=0){var m=n.ovals[n.dragging.index];m.x=r-n.dragging.cx;m.y=p-n.dragging.cy}}function g(m,n){for(var p=0;p<10;p++){n.ovals.push(i(m,n))}}function i(m,p){var n={x:m.rndm(12,m.bounds.width),y:m.rndm(12,m.bounds.height)};return n}function h(m,n){var q=n.ovalRadius*2;for(var p=0;p<n.ovals.length;p++){m.MetaDrawGradient(n.gradient,n.ovals[p].x,n.ovals[p].y,q,q)}}function d(){}function c(){this.Clear();h(this,this.runtime.dmeta);this.MetaPostProcess();this.postEffectA();this.context.fillStyle="#ffffff";this.SetShadow(0,0,6,"#000000");this.context.fillText(" |||  "+this.fps.rate.toFixed(2)+" fps",14,14);this.SetShadow()}function b(n,t,m,s,r){var q=n-s;var p=t-r;return(q*q+p*p<m*m*4)}truss_o.extendModule(l,"view.DMetaspheres",["view.Interface","view.Layers","objects.Tree","view.Structure","core.runtime","view.Menu","extBlur","view.Metaspheres"])}());(function(){function a(d){d.DispatchEvents(c)}function c(h,j){console.log("dispatched: "+h,j);switch(h){case"addNode":var g=this.uuid();var i={};var e=-1;if(typeof j!=="undefined"&&j>=0){e=this.AddObject(g,this.objects[j].x+2,this.objects[j].y+45,i);var d=b(this,j);if(typeof d!=="undefined"){this.PushEvent("moved",[e,d.x,d.y])}this.PushEvent("connectNode",[j,e])}else{e=this.AddObject(g,this.objects.length*4,200,i)}this.PushEvent("NodeProps",[e,i.label,i.labelRight,g]);this.PushEvent("nodeSelected",e);this.update();break;case"NodeProps":this.setPropsI(j[0],j[1],j[2],j[3]);break;case"moved":this.objects[j[0]].x=j[1];this.objects[j[0]].y=j[2];break;case"iseparateNode":if(typeof j!=="undefined"&&j>=0){if(this.separateIfOneConnection(j)){}else{this.runtime.separateWith=j}}break;case"separateNode":this.separateTwo(j[0],j[1]);break;case"removeNode":if(typeof j!=="undefined"&&j>=0){this.RemoveObject(j)}break;case"iconnectNode":if(typeof j!=="undefined"&&j>=0){this.runtime.temporaryConnection=true;this.runtime.connectFrom=j}this.update();break;case"nodeSelected":if(typeof j!=="undefined"&&j>=0){if(this.objects.length<=j){console.log("wrong new index selected");return}this.invokeEvent("nodeFocusLost",[this.selectedNode,j,this.selectedNode>=0?this.objects[this.selectedNode]:null]);this.invokeEvent("nodeSelected",[j,this.objects[j]]);this.selectedNode=j;if(this.runtime.temporaryConnection){this.PushEvent("connectNode",[this.runtime.connectFrom,j]);this.runtime.temporaryConnection=false}if(this.runtime.separateWith>=0){this.PushEvent("separateNode",[this.runtime.separateWith,j]);this.runtime.separateWith=-1}}this.update();break;case"connectNode":this.ConnectIndexes(j[0],j[1]);break}}function b(d,g){var i=d.objects[g];var e=d.ConnectedTo(g);if(e.length===1){var h=d.objects[e[0]];dx=i.x-h.x;dy=i.y-h.y;return{x:dx+i.x,y:dy+i.y}}}truss_o.extendModule(a,"simpleDispatcher",["view.Input","core.runtime"])}());(function(){function e(h){h.Events={};h.addEvent=d;h.addEventCallback=b;h.clearEventCallbacks=g;h.invokeEvent=c;h.addEventListener=a}function d(h){if(typeof this.Events[h]==="undefined"||this.Events[h]===null){this.Events[h]=new Array()}else{throw"the event "+h+" already registered"}}function b(h,i){if(typeof this.Events[h]==="undefined"||this.Events[h]===null){throw"the event "+h+" not registered"}else{this.Events[h].push(i)}}function g(h){if(typeof this.Events[h]==="undefined"||this.Events[h]===null){throw"the event "+h+" not registered"}else{this.Events[h]=new Array()}}function c(j,h){var l=this.Events[j];if(typeof l==="undefined"||l===null){throw"the event "+j+" not registered"}else{for(var k=0;k<l.length;k++){l[k].apply(this,h)}}}function a(j,h){var i=this;var k=this.canvas;if(j=="mouseup"){k=document}k.addEventListener(j,function(m,l,n){h.apply(i,[m,l,n])},false);this.log("registerd evt listener "+j)}truss_o.extendModule(e,"core.Events")}());(function(){function b(h){h.blurCanvas=function(){e(this.context,0,0,this.bounds.width,this.bounds.height,2,1)}}truss_o.extendModule(b,"extBlur","view.Interface");var a=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1];var g=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];function d(r,p,q,i,l){var m=document.getElementById(r);var s=m.naturalWidth;var n=m.naturalHeight;var k=document.getElementById(p);k.style.width=s+"px";k.style.height=n+"px";k.width=s;k.height=n;var j=k.getContext("2d");j.clearRect(0,0,s,n);j.drawImage(m,0,0);if(isNaN(q)||q<1){return}if(i){c(p,0,0,s,n,q,l)}else{e(p,0,0,s,n,q,l)}}function c(X,D,C,h,k,I,M){if(isNaN(I)||I<1){return}I|=0;if(isNaN(M)){M=1}M|=0;if(M>3){M=3}if(M<1){M=1}var L;try{try{L=X.getImageData(D,C,h,k)}catch(S){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");L=X.getImageData(D,C,h,k)}catch(S){alert("Cannot access local image");throw new Error("unable to access local image data: "+S);return}}}catch(S){alert("Cannot access image");throw new Error("unable to access image data: "+S);return}var q=L.data;var n,F,E,s,H,G,N,K,T,R,u,w,t,U,A;var j=h-1;var Q=k-1;var l=h*k;var z=I+1;var B=a[I];var m=g[I];var J=[];var P=[];var V=[];var W=[];var v=[];var O=[];while(M-->0){t=w=0;for(G=0;G<k;G++){n=q[t]*z;F=q[t+1]*z;E=q[t+2]*z;s=q[t+3]*z;for(N=1;N<=I;N++){K=t+(((N>j?j:N))<<2);n+=q[K++];F+=q[K++];E+=q[K++];s+=q[K]}for(H=0;H<h;H++){J[w]=n;P[w]=F;V[w]=E;W[w]=s;if(G==0){v[H]=((K=H+z)<j?K:j)<<2;O[H]=((K=H-I)>0?K<<2:0)}T=t+v[H];R=t+O[H];n+=q[T++]-q[R++];F+=q[T++]-q[R++];E+=q[T++]-q[R++];s+=q[T]-q[R];w++}t+=(h<<2)}for(H=0;H<h;H++){u=H;n=J[u]*z;F=P[u]*z;E=V[u]*z;s=W[u]*z;for(N=1;N<=I;N++){u+=(N>Q?0:h);n+=J[u];F+=P[u];E+=V[u];s+=W[u]}w=H<<2;for(G=0;G<k;G++){q[w+3]=A=(s*B)>>>m;if(A>0){A=255/A;q[w]=((n*B)>>>m)*A;q[w+1]=((F*B)>>>m)*A;q[w+2]=((E*B)>>>m)*A}else{q[w]=q[w+1]=q[w+2]=0}if(H==0){v[G]=((K=G+z)<Q?K:Q)*h;O[G]=((K=G-I)>0?K*h:0)}T=H+v[G];R=H+O[G];n+=J[T]-J[R];F+=P[T]-P[R];E+=V[T]-V[R];s+=W[T]-W[R];w+=h<<2}}}X.putImageData(L,D,C)}function e(m,T,R,J,D,q,N){if(isNaN(q)||q<1){return}q|=0;if(isNaN(N)){N=1}N|=0;if(N>3){N=3}if(N<1){N=1}var Q;try{try{Q=m.getImageData(T,R,J,D)}catch(S){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");Q=m.getImageData(T,R,J,D)}catch(S){alert("Cannot access local image");throw new Error("unable to access local image data: "+S);return}}}catch(S){alert("Cannot access image");throw new Error("unable to access image data: "+S);return}var E=Q.data;var l,z,K,C,w,v,M,F,k,h,P,V,I,B;var n=J-1;var j=D-1;var t=J*D;var G=q+1;var A=[];var O=[];var U=[];var L=a[q];var H=g[q];var s=[];var u=[];while(N-->0){I=V=0;for(v=0;v<D;v++){l=E[I]*G;z=E[I+1]*G;K=E[I+2]*G;for(M=1;M<=q;M++){F=I+(((M>n?n:M))<<2);l+=E[F++];z+=E[F++];K+=E[F++]}for(w=0;w<J;w++){A[V]=l;O[V]=z;U[V]=K;if(v==0){s[w]=((F=w+G)<n?F:n)<<2;u[w]=((F=w-q)>0?F<<2:0)}k=I+s[w];h=I+u[w];l+=E[k++]-E[h++];z+=E[k++]-E[h++];K+=E[k++]-E[h++];V++}I+=(J<<2)}for(w=0;w<J;w++){P=w;l=A[P]*G;z=O[P]*G;K=U[P]*G;for(M=1;M<=q;M++){P+=(M>j?0:J);l+=A[P];z+=O[P];K+=U[P]}V=w<<2;for(v=0;v<D;v++){E[V]=(l*L)>>>H;E[V+1]=(z*L)>>>H;E[V+2]=(K*L)>>>H;if(w==0){s[v]=((F=v+G)<j?F:j)*J;u[v]=((F=v-q)>0?F*J:0)}k=w+s[v];h=w+u[v];l+=A[k]-A[h];z+=O[k]-O[h];K+=U[k]-U[h];V+=J<<2}}}m.putImageData(Q,T,R)}}());(function(){var e=Math.PI/180;function b(l){l.runtime.images={objects:[],atlases:[],loaded:[],textures:[]};l.LoadImage=j;l.AddAtlas=c;l.DrawAtlas=i;l.DrawAtlasAngle=k;l.DrawImage=a;l.ImageLoaded=g;l.CreateTexture=h;l.DrawTexture=d}function d(p,m,l,n,q){this.context.drawImage(p,m,l,n,q)}function h(l,p){var m=this.runtime.images;var n=document.createElement("canvas");n.width=l;n.height=p;m.textures.push(n);return n}function g(l){return this.runtime.images.loaded[l]}function j(m,q){var n=new Image();n.src=m;var p=this.runtime.images.objects.length;var l=this;n.onload=function(){l.runtime.images.loaded[p]=true;console.log("image loaded: "+m);if(typeof q!=="undefined"){q.apply(l,[l.runtime.images.objects[p]])}};this.runtime.images.loaded.push(false);this.runtime.images.objects.push(n);return this.runtime.images.objects.length-1}function a(n,m,l,p,q){if(n<0||!this.ImageLoaded(n)){return}this.context.drawImage(this.runtime.images.objects[n],m,l,p,q)}function c(n,r,q,l,p){var m={i:n,sx:r,sy:q,sw:l,sh:p};this.runtime.images.atlases.push(m);return this.runtime.images.atlases.length-1}function i(q,n,m,p,r){if(q<0){return}var l=this.runtime.images.atlases[q];this.context.drawImage(this.runtime.images.objects[l.i],l.sx,l.sy,l.sw,l.sh,n,m,p,r)}function k(q,n,m,p,r,s){if(q<0){return}var l=this.runtime.images.atlases[q];this.context.save();this.context.translate(n,m);this.context.rotate(s*e);this.context.drawImage(this.runtime.images.objects[l.i],l.sx,l.sy,l.sw,l.sh,0,0,p,r);this.context.restore()}truss_o.extendModule(b,"view.Images",["view.Interface","view.Layers","core.Events","core.runtime"])}());(function(){function d(e){e.runtime.inputEventOut="input_ge";e.runtime.inputEventPush="inpute_gp";e.addEvent(e.runtime.inputEventPush);e.addEvent(e.runtime.inputEventOut);e.PushEvent=b;e.DispatchEvents=c;e.addEventListener("keydown",a);e.canvas.focus();e.canvas.setAttribute("tabindex","0")}function b(g,e){this.invokeEvent(this.runtime.inputEventOut,[g,e])}function c(e){this.addEventCallback(this.runtime.inputEventOut,e)}function a(g){console.log("pressed "+g.keyCode+", ["+String.fromCharCode(g.keyCode)+"]");g.preventDefault()}truss_o.extendModule(d,"view.Input",["view.Interface","core.Events","core.runtime"])}());(function(){function a(k){k.vLayers=[];k.vCurrentLayer=undefined;k.CommonContext=undefined;k.CommonCanvas=undefined;k.addLayer=e;k.setLayer=j;k.saveLayer=d;k.drawLayer=b;k.invalidateLayer=h;k.hasLayerData=g;k.drawLayerPart=c}function e(n,l){var m=i(this,n);if(m<0){var p=document.createElement("canvas");p.width=this.bounds.width;p.height=this.bounds.height;var k=p.getContext("2d");if(l){document.body.appendChild(p)}this.vLayers.push({name:n,canvas:p,context:k,data:undefined})}else{throw"the layer "+n+" already exists"}}function j(l){if(this.vCurrentLayer===l){return false}if(typeof l==="undefined"){this.saveLayer();this.context=this.CommonContext;this.canvas=this.CommonCanvas;this.vCurrentLayer=undefined;return}var k=i(this,l);if(k<0){throw"layer "+l+" not found"}else{this.saveLayer();this.vCurrentLayer=l;this.context=this.vLayers[k].context;this.canvas=this.vLayers[k].canvas}}function d(){if(typeof this.vCurrentLayer==="undefined"){this.CommonContext=this.context;this.CommonCanvas=this.canvas;return}var k=i(this,this.vCurrentLayer);this.vLayers[k].data=this.GetCanvasData()}function b(l){var k=i(this,l);if(k<0){throw"layer "+l+" not found"}if(this.vLayers[k].data!=undefined){this.PutCanvasData(this.vLayers[k].data)}}function c(q,k,s,m,l,p,r){var n=i(this,q);if(n<0){throw"layer "+q+" not found"}this.PutCanvasDataPart(this.vLayers[n].data,k,s,m,l,p,r)}function h(l){var k=i(this,l);if(k<0){throw"layer "+l+" not found"}this.vLayers[k].data=undefined}function g(l){var k=i(this,l);if(k<0){throw"layer "+l+" not found"}return !(typeof this.vLayers[k].data==="undefined")}function i(k,l){for(var m=0;m<k.vLayers.length;m++){if(k.vLayers[m].name===l){return m}}return -1}truss_o.extendModule(a,"view.Layers","view.Interface")}());(function(){var a=230;function i(j){var k=j.runtime;k.metaSpheres={gradients:[],tex:j.CreateTexture(j.bounds.width,j.bounds.height)};j.MetaPrepareGradient=c;j.MetaDrawGradient=b;j.MetaPostProcess=e;j.postEffectA=h;k.metaSpheres.patIMG=j.LoadImage("img/pattern.png",function(l){k.metaSpheres.patFS=j.context.createPattern(l,"repeat")})}function c(j){var k=this.CreateTexture(j*2,j*2);var l=k.getContext("2d");var m=l.createRadialGradient(j,j,1,j,j,j);colour="hsla("+Math.round(Math.random()*360)+", 80%, 60%";m.addColorStop(0,colour+",1)");m.addColorStop(1,colour+",0)");l.fillStyle=m;l.beginPath();l.arc(j,j,j,0,Math.PI*2,true);l.closePath();l.fill();this.runtime.metaSpheres.gradients.push(k);return this.runtime.metaSpheres.gradients.length-1}function b(n,j,m,k,l){var n=this.runtime.metaSpheres.gradients[n];this.DrawTexture(n,j-n.width*0.5,m-n.height*0.5,k,l)}function e(){var m=this.context.getImageData(0,0,this.bounds.width,this.bounds.height),k=m.data;for(var j=0,l=k.length;j<l;j+=4){if(k[j+3]<a){(k[j+3]*=0.2222)}}this.context.putImageData(m,0,0)}function h(){if(typeof this.runtime.metaSpheres.patFS==="undefined"){return}this.context.globalCompositeOperation="darken";this.context.fillStyle=this.runtime.metaSpheres.patFS;this.context.fillRect(0,0,this.bounds.width,this.bounds.height);this.context.globalCompositeOperation="source-over";this.context.fillStyle="rgb(255, 255, 255)"}function d(){var j=4;var k=false;var m=false;var l=false;var p=this.context.getImageData(0,0,this.bounds.width,this.bounds.height);var n=g(p,[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],0,this.runtime.metaSpheres.tex);(this.runtime.metaSpheres.tex.getContext("2d")).putImageData(n,0,0);this.context.globalCompositeOperation="lighter";this.Clear();this.context.drawImage(this.runtime.metaSpheres.tex,0,0)}function g(E,L,q,P){var k=Math.round(Math.sqrt(L.length));var n=Math.floor(k/2);var p=E.data;var F=E.width;var O=E.height;var z=F;var J=O;var s=(P.getContext("2d")).createImageData(z,J);var Q=s.data;var A=q?1:0;for(var t=0;t<J;t++){for(var u=0;u<z;u++){var C=t;var D=u;var G=(t*z+u)*4;var B=0,K=0,M=0,N=0;for(var l=0;l<k;l++){for(var m=0;m<k;m++){var H=C+l-n;var I=D+m-n;if(H>=0&&H<O&&I>=0&&I<F){var v=(H*F+I)*4;var j=L[l*k+m];B+=p[v]*j;K+=p[v+1]*j;M+=p[v+2]*j;N+=p[v+3]*j}}}Q[G]=B;Q[G+1]=K;Q[G+2]=M;Q[G+3]=N+A*(255-N)}}return s}truss_o.extendModule(i,"view.Metaspheres",["view.Images","view.Interface","view.Layers","core.Events","core.runtime"])}());truss_o.option("test2","sayno");truss_o.say();truss_o.option("test2","world");truss_o.option("test3","sayno");truss_o.say();(function(){function h(t){t.objects=[];t.connections=[];t.conIndexes=[];t.AddObject=q;t.Connect=d;t.ConnectIndexes=j;t.NodeIndex=s;t.GetRelatedObjectsDeep=l;t.separateTwo=m;t.separateIfOneConnection=i;t.RemoveObject=a;t.ConnectedTo=e;t.runtime.temporaryConnection=false;t.runtime.connectFrom=-1;t.runtime.separateWith=-1;t.addEvent("NodeAdded");t.addEvent("NodeRemoved");t.addEvent("NodePropsChanged");t.addEvent("NodesSeparated");t.option("view.node.radius",10);t.exportData=g;t.importData=r;t.aabb={x:0,y:0,max_x:0,max_y:0,is_invalidate:false};t.addEvent("NodeDisposition");t.addEventCallback("NodeDisposition",p);t.NodeDisposition=b;t.objs_translate={xoffset:0,yoffset:0};t.setProps=c;t.setPropsI=k}function p(t){this.aabb.x=this.aabb.y=16777215;this.aabb.max_x=this.aabb.max_y=0;this.aabb.is_invalidate=true}function b(t){this.aabb.x=Math.min(t.x-this.options.view.node.radius+this.objs_translate.xoffset,this.aabb.x);this.aabb.y=Math.min(t.y-this.options.view.node.radius+this.objs_translate.yoffset,this.aabb.y);this.aabb.max_x=Math.max(t.x+this.options.view.node.radius+this.objs_translate.xoffset,this.aabb.max_x);this.aabb.max_y=Math.max(t.y+this.options.view.node.radius+this.objs_translate.yoffset,this.aabb.max_y)}function q(u,t,w,v){if(typeof v==="undefined"){v={}}v.name=u;v.x=typeof t==="undefined"||(t===null?0:t);v.y=typeof w==="undefined"||(t===null?0:w);this.objects.push(v);this.invokeEvent("NodeAdded",[u,t,w,v]);return this.objects.length-1}function d(w,v){var u=this.NodeIndex(w);var t=this.NodeIndex(v);if(u<0||t<0){throw"the nodes for connection not found"}if(u===t){return false}if(n(this,u,t)){return false}this.connections.push([w,v]);this.conIndexes.push([u,t]);return true}function j(u,t){if(u<0||this.objects.length<=u||t<0||this.objects.length<=t){throw"the nodes indexes out of bounds"}if(u===t||n(this,u,t)){return false}this.connections.push([this.objects[u].name,this.objects[t].name]);this.conIndexes.push([u,t]);return true}function n(w,v,u){for(var t=0;t<w.conIndexes.length;t++){if((w.conIndexes[t][0]===v||w.conIndexes[t][0]===u)&&(w.conIndexes[t][1]===v||w.conIndexes[t][1]===u)){return true}}return false}function s(t){for(var u=0;u<this.objects.length;u++){if(this.objects[u].name===t){return u}}return -1}function l(w){var t=[w];for(var u=0;u<t.length;u++){for(var v=0;v<this.conIndexes.length;v++){if(this.conIndexes[v][0]==t[u]&&t.indexOf(this.conIndexes[v][1])<0){t.push(this.conIndexes[v][1])}}}return t}function g(){var t={version:this.version,clientDate:Date()};t.objects=[];for(var u=0;u<this.objects.length;u++){t.objects.push({name:this.objects[u].name,x:this.objects[u].x,y:this.objects[u].y,label:this.objects[u].label,labelRight:this.objects[u].labelRight})}t.connections=this.conIndexes;return t}function r(t){if(typeof t.objects==="object"&&t.objects.length>=0&&typeof t.connections==="object"&&t.connections.length>=0){this.objects=t.objects;this.conIndexes=t.connections;this.update()}}function c(v,u,t){this.PushEvent("NodeProps",[this.FindNode(v),u,t,undefined])}function k(w,v,u,t){this.objects[w].label=v;this.objects[w].labelRight=u;if(typeof t!=="undefined"){this.objects[w].name=t}this.invokeEvent("NodePropsChanged",[w])}function i(z){var y=this;var v=0;var x=-1;for(var w=0;w<y.conIndexes.length;w++){if(y.conIndexes[w][0]===z||y.conIndexes[w][1]===z){v++;x=w}}if(v==1){var u=y.conIndexes[x][0];var t=y.conIndexes[x][1];this.conIndexes.splice(x,1);this.invokeEvent("NodesSeparated",[u,t]);return true}return false}function m(u,t){var x=this;var w=-1;for(var v=0;v<x.conIndexes.length;v++){if((x.conIndexes[v][0]===u&&x.conIndexes[v][1]===t)||(x.conIndexes[v][1]===u&&x.conIndexes[v][0]===t)){w=v;break}}if(w>=0){this.conIndexes.splice(w,1);this.invokeEvent("NodesSeparated",[u,t]);return true}return false}function a(t){var v=this.objects[t];this.objects.splice(t,1);for(var u=0;u<this.conIndexes.length;u++){if(this.conIndexes[u][0]===t||this.conIndexes[u][1]===t){this.conIndexes.splice(u,1);this.connections.splice(u,1);u--}}for(var u=0;u<this.conIndexes.length;u++){if(this.conIndexes[u][0]>t){this.conIndexes[u][0]--}if(this.conIndexes[u][1]>t){this.conIndexes[u][1]--}}this.invokeEvent("NodeRemoved",[v,t])}function e(u){var t=[];for(var v=0;v<this.conIndexes.length;v++){if(this.conIndexes[v][1]===u){t.push(this.conIndexes[v][0])}}return t}truss_o.extendModule(h,"objects.Tree",["core.Events","core.runtime"])}());(function(){function a(b){b.runtime={}}truss_o.extendModule(a,"core.runtime")}());(function(){var c="SPetalis.background";var b="SPetalis.menu";function p(u){var x={Render:r,update:g};u.addViewEngine("SakuraPetalis",x);u.setViewEngine("SakuraPetalis");u.addLayer(b);var w=u.runtime;w.spetalis={petalis:[],directionVectors:[],wind:{x:5,y:5,speed:0.24},dt:0,lastInvDate:new Date(),atlasIds:[],invFooDirection:true,flowBatAwait:[]};var v=u.LoadImage("img/petalis.png");w.spetalis.atlasIds.push(u.AddAtlas(v,11,13,89,82));w.spetalis.atlasIds.push(u.AddAtlas(v,126,13,79,82));w.spetalis.atlasIds.push(u.AddAtlas(v,243,13,91,104));w.spetalis.atlasIds.push(u.AddAtlas(v,7,137,101,102));w.spetalis.atlasIds.push(u.AddAtlas(v,120,149,99,90));w.spetalis.atlasIds.push(u.AddAtlas(v,237,149,100,109));w.spetalis.atlasIds.push(u.AddAtlas(v,232,261,113,130));w.spetalis.atlasIds.push(u.AddAtlas(v,123,266,89,87));w.spetalis.atlasIds.push(u.AddAtlas(v,9,270,95,88));w.spetalis.background={b1:-1,b2:-1};w.spetalis.background.b3=u.LoadImage("img/KUx_Ev0KXHI.jpg");m(w.spetalis);t(w.spetalis,u.bounds);u.CreateTimer(1000/30,a);u.CreateTimer(1000/4,s);u.CreateTimer(1000/30,i);console.log(w.spetalis);u.AddDisplayMenu("petalisMenu",{items:[{text:"the links below will opened in this tab",callback:null},{text:"all coded by cerriun",callback:function(){window.location.href="https://github.com/skipme"}},]});u.canvas.oncontextmenu=function(){return false};u.addEventListener("mousedown",function(z){if(z.which!=1){var A=z.pageX-this.bounds.left;var y=z.pageY-this.bounds.top;this.ShowMenu("petalisMenu",A,y)}})}function m(u){for(var w=0;w<200;w++){var v={x:h(-5,5),y:h(-5,5),maxX:0,maxY:0,minX:0,minY:0,incDX:true,incDY:true};if(v.x===0){v.x=1}if(v.y===0){v.y=1}v.maxX=v.x*1.5;v.maxY=v.y*1.5;v.minX=v.x-(v.maxX-v.x);v.minY=v.y-(v.maxY-v.y);u.directionVectors.push(v)}for(var w=0;w<5;w++){u.flowBatAwait.push(h(5000,20000))}}function t(u,w){for(var v=0;v<500;v++){u.petalis.push(e(u,w))}}function e(u,w){var v={dVector:(h(0,u.directionVectors.length)-1),windforce:0.1,atlas:(h(0,u.atlasIds.length)-1),angle:{now:h(0,120),isInc:true},x:h(0,w.width),y:h(0,w.height),opacity:h(1,20),wait_until:(new Date)+h(0,1000)};return v}function a(){var u=this.runtime.spetalis;var w=(new Date);u.dt=(w-u.lastInvDate);if(u.dt>100){u.lastInvDate=w;u.invFooDirection=!u.invFooDirection}var v=u.dt/100;for(var x=0;x<u.petalis.length;x++){k(u,u.petalis[x],v,this.bounds)}this.update()}function k(u,v,A,z){if(v.wait_until>Date.now()){return}var y=n(A,1);var x=u.directionVectors[v.dVector];var w=u.wind;v.x+=(x.x+u.wind.x)*w.speed;v.y+=(x.y+u.wind.y)*w.speed;if(v.x>z.width){v.x=0;v.wait_until=Date.now();v.wait_until+=u.flowBatAwait[h(0,u.flowBatAwait.length)-1]}if(v.y>z.height){v.y=0;v.wait_until=Date.now();v.wait_until+=u.flowBatAwait[h(0,u.flowBatAwait.length)-1]}if(v.x<0){v.x=z.width}if(v.y<0){v.y=z.height}}function i(){var u=this.runtime.spetalis;var w=(new Date);u.dt=(w-u.lastInvDate);var y=d(u.dt/100);y=Math.abs(y);y*=3;for(var x=0;x<u.petalis.length;x++){var v=u.petalis[x];if(v.angle.isInc){v.angle.now+=y;if(v.angle>120){v.angle.isInc=false}}else{v.angle.now-=y;if(v.angle<0){v.angle.isInc=true}}}}function s(){var u=this.runtime.spetalis;var w=(new Date);u.dt=(w-u.lastInvDate);var y=d(u.dt/100);y=Math.abs(y);if(y>1){y=1}for(var x=0;x<u.directionVectors.length;x++){var v=u.directionVectors[x];if(v.incDY){v.y+=y}if(v.incDX){v.x+=y}if(!v.incDX){v.x-=y}if(!v.incDY){v.y-=y}if(v.x>=v.maxX){v.incDX=false;v.x=v.maxX}if(v.y>=v.maxY){v.incDY=false;v.x=v.maxY}if(v.x<=v.minX){v.incDX=true;v.x=v.minX}if(v.y<=v.minY){v.incDY=true;v.y=v.minY}}}function q(u,v,x,w){}function l(v,u){var x=Date.now();for(var y=0;y<u.petalis.length;y++){var w=u.petalis[y];if(w.wait_until>x){continue}v.context.globalAlpha=w.opacity/20;v.DrawAtlasAngle(w.atlas,w.x,w.y,10,10,w.angle.now)}v.context.globalAlpha=1;v.context.globalCompositeOperation="source-over"}function g(){this.invalidateLayer(b)}function r(){this.setLayer();this.Clear();var u=this.runtime.spetalis;this.DrawImage(u.background.b3,0,0,this.bounds.width,this.bounds.height);l(this,u);this.postEffectA();this.context.fillStyle="#ffffff";this.SetShadow(0,0,6,"#000000");this.context.fillText(" you are using html5 canvas  "+this.fps.rate.toFixed(2)+" fps",14,14);this.SetShadow();if(!this.hasLayerData(b)){this.setLayer(b);this.Clear();this.RenderDisplayMenuText(b,true);this.RenderDisplayMenuBackground(b);this.RenderDisplayMenuText(b);this.saveLayer()}this.setLayer();this.drawLayer(b)}function h(v,u){return v+Math.floor((Math.random()*(u-v)+1))}function n(v,u){return Math.pow(v,2)*((u+1)*v-u)}function j(v,u){return Math.pow(2,10*(v-1))*Math.cos(20*Math.PI*u/3*v)}function d(x){for(var w=0,v=1,u;1;w+=v,v/=2){if(x>=(7-4*w)/11){return -Math.pow((11-6*w-11*x)/4,2)+Math.pow(v,2)}}}truss_o.extendModule(p,"view.SakuraPetalis",["view.Interface","view.Layers","objects.Tree","view.Structure","core.runtime","view.Menu","extBlur"])}());(function(){function p(r){r.mouseDragContext={startX:0,startY:0};r.selectedNode=-1;r.Dragging=false;r.FieldDragging=false;r.FieldDraggingPos={startX:0,startY:0,prevX:0,prevY:0};r.moveNodeTo=j;r.DragList=[];r.AddDisplayMenu("node",{items:[{text:"Add + connect",callback:m},{text:"---------------"},{text:"Separate",callback:q},{text:"Connect with...",callback:g},{text:"Remove",callback:n},]});r.DeltasMeasuring=[];r.addEventListener("mousedown",e);r.addEventListener("mouseup",a);r.addEventListener("mousemove",l);r.addEvent("MouseDragDelta");r.addEvent("nodeSelected");r.addEvent("nodeFocusLost");r.addEventCallback("Render",d);r.addDeltaMeasuring=h;r.CreateTimer(30,c);r.canvas.oncontextmenu=function(){if(typeof r.menu.displayMenu==="undefined"&&r.selectedNode>=0){r.ShowMenu("test",r.objects[r.selectedNode].x,r.objects[r.selectedNode].y)}return false}}function q(){this.PushEvent("iseparateNode",this.selectedNode)}function m(){this.PushEvent("addNode",this.selectedNode)}function n(){this.PushEvent("removeNode",this.selectedNode)}function g(){this.PushEvent("iconnectNode",this.selectedNode)}function c(){for(var s=0;s<this.DeltasMeasuring.length;s++){var r=this.DeltasMeasuring[s];if(r[0]>=r[1]){r[2].call(this);r[0]=0}}}function h(r,s){this.DeltasMeasuring.push([0,r,s]);return this.DeltasMeasuring.length-1}function i(){}function k(r){}function e(t){if(this.Dragging){return}if(t.which==1||t.which==3){this.updateBounds();var w=-1;var v=t.pageX-this.bounds.left;var s=t.pageY-this.bounds.top;if(this.menu.displayMenu){if(this.processInteractionMMdown(t.which,v,s)){return}}var u=false;for(var r=0;r<this.objects.length;r++){if(b(this.objects[r].x+this.objs_translate.xoffset,this.objects[r].y+this.objs_translate.yoffset,this.options.view.node.radius,v,s)){if(this.selectedNode===r){u=true;continue}u=false;this.PushEvent("nodeSelected",r);w=r;break}}if(w<0&&!u){this.invokeEvent("nodeFocusLost",[this.selectedNode,-1,this.objects[this.selectedNode]]);this.selectedNode=-1}if(t.which==1){this.HideMenu();if(this.selectedNode>=0){this.Dragging=true;this.DragList=this.GetRelatedObjectsDeep(this.selectedNode);for(var r=0;r<this.DragList.length;r++){o=this.objects[this.DragList[r]];o.targetX=0;o.targetY=0;o.dragOn=false}this.mouseDragContext.startX=v-this.objects[this.selectedNode].x-this.objs_translate.xoffset;this.mouseDragContext.startY=s-this.objects[this.selectedNode].y-this.objs_translate.yoffset;this.objects[this.selectedNode].dragOn=false;this.objects[this.selectedNode].targetX=0;this.objects[this.selectedNode].targetY=0;this.objects[this.selectedNode].prevx=this.objects[this.selectedNode].x;this.objects[this.selectedNode].prevy=this.objects[this.selectedNode].y}this.FieldDragging=w==-1;if(this.FieldDragging){this.FieldDraggingPos.startX=v;this.FieldDraggingPos.startY=s;this.FieldDraggingPos.prevX=this.objs_translate.xoffset;this.FieldDraggingPos.prevY=this.objs_translate.yoffset}this.update()}else{if(this.selectedNode>=0){this.ShowMenu("node",v,s)}else{this.HideMenu()}}}this.canvas.focus();t.preventDefault()}function a(r){if(r.which==1){if(this.FieldDragging){this.FieldDragging=false}if(this.Dragging){this.Dragging=false;if(this.selectedNode>=0&&(this.objects[this.selectedNode].x!=this.objects[this.selectedNode].prevx||this.objects[this.selectedNode].y!=this.objects[this.selectedNode].prevy)){this.PushEvent("moved",[this.selectedNode,this.objects[this.selectedNode].x,this.objects[this.selectedNode].y])}}}r.preventDefault()}function l(w){var x=w.pageX-this.bounds.left;var v=w.pageY-this.bounds.top;this.runtime.mx=x;this.runtime.my=v;if(this.Dragging){this.moveNodeTo(this.selectedNode,x-this.objs_translate.xoffset-this.mouseDragContext.startX,v-this.objs_translate.yoffset-this.mouseDragContext.startY);this.update()}else{if(this.FieldDragging){var s=x-this.FieldDraggingPos.startX;var r=v-this.FieldDraggingPos.startY;this.objs_translate.xoffset=s+this.FieldDraggingPos.prevX;this.objs_translate.yoffset=r+this.FieldDraggingPos.prevY;var u=Math.sqrt(Math.pow(s,2)+Math.pow(r,2));for(var t=0;t<this.DeltasMeasuring.length;t++){this.DeltasMeasuring[t][0]+=u}this.update()}else{if(this.runtime.temporaryConnection){this.update()}}}this.processInteractionMMove(x,v);w.preventDefault()}function b(s,z,r,w,v){var u=s-w;var t=z-v;return(u*u+t*t<r*r*4)}function j(t,s,r){this.objects[t].targetX=s;this.objects[t].targetY=r;this.objects[t].dragOn=true}function d(){var x=0;var v=0;if(this.selectedNode>=0){this.objects[this.selectedNode].needDrag=(Math.abs(this.objects[this.selectedNode].x-this.objects[this.selectedNode].targetX)>0.1)||(Math.abs(this.objects[this.selectedNode].y-this.objects[this.selectedNode].targetY)>0.1);if(this.objects[this.selectedNode].needDrag&&this.objects[this.selectedNode].dragOn){var s=0.4*(this.objects[this.selectedNode].targetX-this.objects[this.selectedNode].x);var r=0.4*(this.objects[this.selectedNode].targetY-this.objects[this.selectedNode].y);this.objects[this.selectedNode].x=this.objects[this.selectedNode].x+s;this.objects[this.selectedNode].y=this.objects[this.selectedNode].y+r;for(var u=1;u<this.DragList.length;u++){var t=this.DragList[u];this.objects[t].x+=s;this.objects[t].y+=r}x=Math.max(x,Math.abs(s));v=Math.max(v,Math.abs(r))}}if(x>0||v>0){var w=Math.sqrt(Math.pow(x,2)+Math.pow(v,2));for(var u=0;u<this.DeltasMeasuring.length;u++){this.DeltasMeasuring[u][0]+=w}}}truss_o.extendModule(p,"view.Structure",["view.Input","core.Events","core.Animate","objects.Tree","view.Interface","view.Menu"])}());(function(){function r(v){q(v);v.updateBounds=function(){q(v)};v.ViewEngines=[];v.ActiveEngine=null;v.addViewEngine=l;v.setViewEngine=m;v.FindViewEngine=k;v.Clear=u;v.ClearRect=d;v.GetCanvasData=a;v.PutCanvasData=i;v.PutCanvasDataPart=n;v.SetShadow=e;v.drawArrow=g;v.addEventCallback("NodeAdded",s);v.addEventCallback("NodesSeparated",p);v.addEventCallback("NodeRemoved",b);v.addEventCallback("Render",t);v.addEventCallback("update",j)}function q(v){v.bounds={width:v.canvas.width,height:v.canvas.height,left:v.canvas.offsetLeft,top:v.canvas.offsetTop}}function l(v,x){var w=this.FindViewEngine(v);if(w<0){this.ViewEngines.push({name:v,iface:x})}else{throw"the view engine "+v+" already registered"}}function m(v){var w=this.FindViewEngine(v);if(w<0){throw"the view interface "+v+" not found"}this.ActiveEngine=this.ViewEngines[w]}function k(v){for(var w=0;w<this.ViewEngines.length;w++){if(this.ViewEngines[w].name===v){return w}}return -1}function u(){this.context.clearRect(0,0,this.bounds.width,this.bounds.height)}function d(v){this.context.clearRect(v.x,v.y,v.width,v.height)}function a(){var v=this.canvas;return v}function i(v){this.context.drawImage(v,0,0)}function n(D,v,C,z,w,A,B){this.context.drawImage(D,v,C,z,w,A,B)}function s(w,v){this.update()}function p(w,v){this.update()}function b(w,v){this.update()}function c(v,w){if(v.ActiveEngine!==null){v.ActiveEngine.iface[w].call(v)}}function e(v,y,x,w){if(typeof v==="undefined"){this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowBlur=0;this.context.shadowColor=0}else{this.context.shadowOffsetX=v;this.context.shadowOffsetY=y;this.context.shadowBlur=x;this.context.shadowColor=w}}function j(){c(this,"update")}function t(){c(this,"Render")}function g(K,y,I,x,J,E,L,N){J=typeof(J)!="undefined"?J:3;E=typeof(E)!="undefined"?E:1;L=typeof(L)!="undefined"?L:Math.PI/8;N=typeof(N)!="undefined"?N:10;var G=typeof(J)!="function"?h:J;var F=Math.sqrt((I-K)*(I-K)+(x-y)*(x-y));var B=(F-N/3)/F;var D,C,O,M;if(E&1){D=K+(I-K)*B;C=y+(x-y)*B}else{D=I;C=x}if(E&2){O=K+(I-K)*(1-B);M=y+(x-y)*(1-B)}else{O=K;M=y}this.context.beginPath();this.context.moveTo(O,M);this.context.lineTo(D,C);this.context.stroke();var R=Math.atan2(x-y,I-K);var H=Math.abs(N/Math.cos(L));if(E&1){var w=R+Math.PI+L;var A=I+Math.cos(w)*H;var z=x+Math.sin(w)*H;var v=R+Math.PI-L;var Q=I+Math.cos(v)*H;var P=x+Math.sin(v)*H;G(this.context,A,z,I,x,Q,P,J)}if(E&2){var w=R+L;var A=K+Math.cos(w)*H;var z=y+Math.sin(w)*H;var v=R-L;var Q=K+Math.cos(v)*H;var P=y+Math.sin(v)*H;G(this.context,A,z,K,y,Q,P,J)}}function h(H,P,z,N,x,K,v,L){H.beginPath();H.moveTo(P,z);H.lineTo(N,x);H.lineTo(K,v);H.stroke();switch(L){case 0:var R=Math.sqrt(((K-P)*(K-P))+((v-z)*(v-z)));H.arcTo(N,x,P,z,0.55*R);H.fill();break;case 1:H.lineTo(P,z);H.fill();break;case 2:H.stroke();break;case 3:var C=(P+N+K)/3;var A=(z+x+v)/3;H.quadraticCurveTo(C,A,P,z);H.fill();break;case 4:var O,M,y,w,R;var F=5;if(K==P){R=v-z;O=(N+P)/2;y=(N+P)/2;M=x+R/F;w=x-R/F}else{R=Math.sqrt(((K-P)*(K-P))+((v-z)*(v-z)));var I=(P+K)/2;var B=(z+v)/2;var J=(I+N)/2;var Q=(B+x)/2;var G=(v-z)/(K-P);var E=(R/(2*Math.sqrt(G*G+1)))/F;var D=G*E;O=J-E;M=Q-D;y=J+E;w=Q+D}H.bezierCurveTo(O,M,y,w,P,z);H.fill();break}}truss_o.extendModule(r,"view.Interface",["core.Events","core.Animate"])}());(function(){var h="dbg.background";var e="dbg.nodes";var g="dbg.text";var a="dbg.menu";var c=[];function r(x){var y={Render:v,update:j};x.option("view.dbg.backgroundColor1","rgba(60, 78, 98, 1)");x.option("view.dbg.backgroundColor2","rgba(35, 47, 59, 1)");x.addViewEngine("Debug",y);x.setViewEngine("Debug");x.addLayer(h);x.addLayer(e);x.addLayer(g);x.addLayer(a);x.addEventCallback("MouseDragDelta",l);x.addEventCallback("NodePropsChanged",t);x.addDeltaMeasuring(2,s);x.runtime.InvalidateTextlayer=false;x.aabb={x:23,y:44,max_x:66,max_y:88};x.setBackground=d;x.CreateTimer(1000/30,i)}function m(x,z){for(var y=0;y<z.length;y++){f=z[y];if(!f.visible){continue}x.context.globalAlpha=f.opacity/20;x.DrawAtlas(f.atlas,f.x,f.y,f.szR,f.szR)}x.context.globalAlpha=1}function n(x,z){for(var y=0;y<z.length;y++){f=z[y];if(!f.visible){continue}x.context.fillStyle="rgba(255, 255, 255, 0."+f.opacity+")";x.context.beginPath();x.context.arc(f.x,f.y,f.szR,0,2*Math.PI,false);x.context.closePath();x.context.fill()}}function i(){var x=this;if(typeof x.flexes==="undefined"){var y=x.LoadImage("img/petalis.png");c.push(x.AddAtlas(y,11,13,89,82));c.push(x.AddAtlas(y,126,13,79,82));c.push(x.AddAtlas(y,243,13,91,104));x.flexes={layblink:[],lay1:[],lay2:[],lay3:[],lastIteration:new Date(),lastIterationVis:new Date()};flexCnt=190;x.updateBounds();w(x.flexes.lay1,flexCnt,x.bounds);w(x.flexes.lay2,flexCnt,x.bounds);w(x.flexes.layblink,flexCnt,x.bounds);w(x.flexes.lay3,flexCnt,x.bounds)}else{b(x.flexes.lay1,x.bounds);b(x.flexes.lay2,x.bounds);b(x.flexes.layblink,x.bounds);b(x.flexes.lay3,x.bounds);if((new Date())-x.flexes.lastIterationVis>1000){q(x.flexes.layblink);x.flexes.lastIterationVis=new Date()}x.flexes.lastIteration=Date();x.update()}}function b(y,z){for(var x=0;x<y.length;x++){var A=y[x];A.x+=A.stepx;A.y+=A.stepy;if(A.x>z.width){A.x=0}if(A.y>z.height){A.y=0}if(A.x<0){A.x=z.width}}}function q(y){for(var x=0;x<y.length;x++){f=y[x];f.visible=k(1,20)!=10}}function w(z,x,A){for(var y=0;y<x;y++){var B={visible:true,szR:k(3,12),x:k(0,A.width),y:k(0,A.height),stepx:k(-1,3),stepy:k(1,3),opacity:k(1,20),atlas:(k(0,c.length)-1)};if(B.stepx==0){B.stepx=1}z.push(B)}}function k(y,x){return y+Math.floor((Math.random()*(x-y)+1))}function u(x){if(typeof x.flexes!="undefined"){m(x,x.flexes.lay1);m(x,x.flexes.layblink);m(x,x.flexes.lay2);m(x,x.flexes.lay3)}}function j(){this.invalidateLayer(g);this.invalidateLayer(a)}function t(){this.update()}function d(y,x){if(typeof y!="undefined"){this.options.view.dbg.backgroundColor1=y}if(typeof x!="undefined"){this.options.view.dbg.backgroundColor2=x}this.invalidateLayer(h);this.update()}function p(x){x.SetShadow();x.context.lineWidth=1;x.context.strokeStyle="#FaFaFa";x.context.strokeRect(x.aabb.x,x.aabb.y,x.aabb.max_x-x.aabb.x,x.aabb.max_y-x.aabb.y)}function s(){this.runtime.InvalidateTextlayer=true}function v(){if(this.hasLayerData(h)){this.setLayer();this.Clear();this.SetShadow();this.drawLayer(h)}else{this.setLayer(h);this.dbgview={};this.dbgview.gradientBackground=this.context.createRadialGradient(280,320,0,300,300,500);this.dbgview.gradientBackground.addColorStop(0,this.options.view.dbg.backgroundColor1);this.dbgview.gradientBackground.addColorStop(1,this.options.view.dbg.backgroundColor2);this.context.fillStyle=this.dbgview.gradientBackground;this.context.fillRect(0,0,this.bounds.width,this.bounds.height);this.saveLayer();this.setLayer();this.drawLayer(h)}this.context.font="8pt Verdana";this.setLayer();u(this);this.SetShadow();this.context.fillStyle="rgb(255, 255, 255)";var z=false;if(this.runtime.separateWith>=0){z=true}this.aabb={x:16777215,y:16777215,max_x:-16777215,max_y:-16777215};this.context.fillText(this.fps.rate.toFixed(2)+" fps",14,14);this.setLayer(e);this.Clear();this.context.translate(this.objs_translate.xoffset,this.objs_translate.yoffset);this.SetShadow();this.context.fillStyle="rgb(255, 255, 255)";for(var G=0;G<this.conIndexes.length;G++){var K=0;var B=0;var J=0;var A=0;K=this.objects[this.conIndexes[G][0]].x;B=this.objects[this.conIndexes[G][0]].y;J=this.objects[this.conIndexes[G][1]].x;A=this.objects[this.conIndexes[G][1]].y;var I=4;var D=this.options.view.node.radius;var P=J-K;var O=A-B;var M=Math.sqrt(Math.pow(P,2)+Math.pow(O,2));var F=D/M;var N=J-(F*P);var L=A-(F*O);var K=K+(F*P);var B=B+(F*O);if(z){if(this.runtime.separateWith==this.conIndexes[G][0]||this.runtime.separateWith==this.conIndexes[G][1]){this.context.fillStyle=this.context.strokeStyle="#FFFFFF"}else{this.context.fillStyle=this.context.strokeStyle="#aaaaaa"}}this.drawArrow(K,B,N,L,3,1,Math.PI/4,I)}for(var G=0;G<this.objects.length;G++){this.context.lineWidth=0.5;if(this.selectedNode==G){this.context.fillStyle="rgba(68, 110, 150, 0.6)"}else{this.context.fillStyle="rgba(0, 0, 0, 0.2)"}this.context.strokeStyle="#FFFFFF";this.context.beginPath();this.context.arc(this.objects[G].x,this.objects[G].y,this.options.view.node.radius,0,2*Math.PI,false);this.context.closePath();this.context.fill();this.context.stroke();this.NodeDisposition(this.objects[G])}if(this.aabb.is_invalidate){this.aabb.is_invalidate=false}this.context.translate(-this.objs_translate.xoffset,-this.objs_translate.yoffset);p(this);this.saveLayer();this.setLayer();this.SetShadow();this.drawLayer(e);if(!this.runtime.InvalidateTextlayer&&this.hasLayerData(g)){}else{this.runtime.InvalidateTextlayer=false;this.setLayer(g);this.Clear();this.context.font="9pt Verdana";this.SetShadow();this.context.translate(this.objs_translate.xoffset,this.objs_translate.yoffset);this.context.fillStyle="rgb(255, 255, 255)";for(var G=0;G<this.objects.length;G++){if(this.objects[G].label!=undefined){var H=this.context.measureText(this.objects[G].label);var E=this.objects[G].x-this.options.view.node.radius-H.width-4;var C=this.objects[G].y+this.options.view.node.radius*0.5;this.context.fillStyle="rgba(100, 100, 100, 0.5)";this.context.fillRect(E,C-10,H.width,12);this.context.fillStyle="rgb(255, 255, 255)";this.context.fillText(this.objects[G].label,E,C)}if(this.objects[G].labelRight!=undefined){this.context.fillStyle="rgb(255, 255, 255)";this.context.fillText(this.objects[G].labelRight,this.objects[G].x+this.options.view.node.radius+4,this.objects[G].y+this.options.view.node.radius*0.5)}}this.context.translate(-this.objs_translate.xoffset,-this.objs_translate.yoffset);this.saveLayer()}if(this.runtime.temporaryConnection){index=this.runtime.connectFrom;K=this.objects[index].x;B=this.objects[index].y;J=this.runtime.mx-this.objs_translate.xoffset;A=this.runtime.my-this.objs_translate.yoffset;var I=4;var D=this.options.view.node.radius;var P=J-K;var O=A-B;var M=Math.sqrt(Math.pow(P,2)+Math.pow(O,2));var F=D/M;var N=J-(F*P);var L=A-(F*O);var K=K+(F*P);var B=B+(F*O);this.setLayer();this.SetShadow();this.context.translate(this.objs_translate.xoffset,this.objs_translate.yoffset);this.context.fillStyle="#aaaaaa";this.context.strokeStyle="#aaaaaa";this.drawArrow(K,B,N,L,3,1,Math.PI/4,I);this.context.translate(-this.objs_translate.xoffset,-this.objs_translate.yoffset)}if(!this.hasLayerData(a)){this.setLayer(a);this.Clear();this.RenderDisplayMenuText(a,true);this.RenderDisplayMenuBackground(a);this.RenderDisplayMenuText(a);this.saveLayer()}this.setLayer();this.SetShadow();this.drawLayer(g);this.drawLayer(a)}function l(z,A){}truss_o.extendModule(r,"view.Debug",["view.Interface","view.Layers","objects.Tree","view.Structure","core.runtime","view.Menu","extBlur"])}());
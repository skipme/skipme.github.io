var truss_o;(function(){var i={test:"hello",test2:"world"};var h=function(l){console.log(l)};var g=[];function c(n,p,q){if(n.indexOf(".")===-1){if(q||(this.options[n]===null||typeof this.options[n]==="undefined")){this.options[n]=p}}else{var r=n.split(".");var l=this.options;for(var m=0;m<r.length-1;m++){if(r[m]===null||typeof r[m]==="undefined"){throw"The property path not well formed: "+n+" defaultval: "+p}if(typeof l[r[m]]==="undefined"){l[r[m]]={}}l=l[r[m]]}l[r[r.length-1]]=p}}function k(l,m,n){g.push({name:m,after:n,foo:l})}function j(n){if(!n||"object"!==typeof n){return n}var q="function"===typeof n.pop?[]:{};var m,l;for(m in n){if(n.hasOwnProperty(m)){l=n[m];if(l&&"object"===typeof l){q[m]=j(l)}else{q[m]=l}}}return q}function a(l){var m=j(this);m.canvas=l;m.context=l.getContext("2d");d(m);delete m.create;delete m.extendModule;return m}function d(m){var l;var n=0;while(!l){l=e(m);if(!l){if(m.options.registered.length==n){throw"missed some module"}}n=m.options.registered.length}h("extended by "+g.length+" modules")}function e(p){var l=true;p.option("registered",new Array());var r=p.options.registered;for(var n=0;n<g.length;n++){if(r.indexOf(g[n].name)>=0){continue}var q=true;if(typeof g[n].after==="string"){if(r.indexOf(g[n].after)>=0){q=true}else{q=false}}else{if(typeof g[n].after==="object"){q=true;for(var m=0;m<g[n].after.length;m++){if(r.indexOf(g[n].after[m])<0){q=false;break}}}else{if(typeof g[n].after==="undefined"){q=true}}}if(q){g[n].foo(p);r.push(g[n].name);h("extended by "+g[n].name)}else{l=false}}return l}function b(){h(this.options.test+" "+this.options.test2)}truss_o={version:"0.1 devTool",options:i,option:c,say:b,extendModule:k,create:a,log:h};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(l){window.setTimeout(l,1000/60)}})()}());(function(){var h=10;function g(j){j.fps={};j.fps.rate=0;j.fps.now=0;j.fps.lastUpdate=(new Date)*1-1;j.addEvent("Render");j.addEvent("update");j.StopAnim=false;j.SuspendFrame=false;j.animFrame=d;j.option("animFps",30);j.animFPS=0;e(j);j.timers=[];j.CreateTimer=c;j.uselessFrames=500;j.suspendAnimation=a;j.update=i}function d(j){var k=1000/((j.fps.now=new Date)-j.fps.lastUpdate);j.fps.rate+=(k-j.fps.rate)/h;j.fps.lastUpdate=j.fps.now;if(!j.StopAnim){if(j.uselessFrames<=-5){j.suspendAnimation()}j.invokeEvent("Render");j.uselessFrames--}}function c(k,m){var j=this;var l=setInterval(function(){m.call(j)},k);this.timers.push(l)}function b(j){j.animFrame(j)}function e(j){b(j);if(!j.SuspendFrame){requestAnimFrame(function(){e(j)})}}function a(){this.SuspendFrame=true}function i(){if(this.SuspendFrame){this.SuspendFrame=false;this.uselessFrames=30;e(this);console.log("frame loop-->")}else{this.uselessFrames=30}this.invokeEvent("update")}truss_o.extendModule(g,"core.Animate",["core.Events","core.runtime"])}());(function(){function l(m){m.menu={menuList:[],displayMenuName:"",displayMenu:null,displayMenuOrigin:{x:0,y:0},displayMenuBounds:{mwidth:0,h:0}};m.RenderDisplayMenuText=function(n,p){j(this,n,p)};m.RenderDisplayMenuBackground=function(n){c(this,n)};m.AddDisplayMenu=k;m.ShowMenu=function(p,n,r,q){i(this,p,n,r)};m.HideMenu=g;m.processInteractionMMove=d;m.processInteractionMMdown=h}function g(){this.menu.displayMenu=undefined;this.update()}function k(n,m){m.name=n;this.menu.menuList.push(m)}function a(m,n){for(var p=0;p<m.menu.menuList.length;p++){if(m.menu.menuList[p].name==n){return m.menu.menuList[p]}}return undefined}function i(n,p,m,r){var q=a(n,p);if(typeof q==="undefined"){return}n.menu.displayMenuName=p;n.menu.displayMenu=q;n.menu.displayMenuOrigin.x=m;n.menu.displayMenuOrigin.y=r;n.update()}function e(n,m){j(this,n);c(this,m)}function j(r,q,p){var u=r.menu.displayMenu;if(u){r.setLayer(q);r.SetShadow();r.context.font="8pt Verdana";r.context.textBaseline="top";r.context.textAlign="start";r.context.fillStyle="rgb(255, 255, 255)";var t=r.menu.displayMenuOrigin.x;var s=r.menu.displayMenuOrigin.y;for(var m=0;m<u.items.length;m++){var v=u.items[m];var n=r.context.measureText(v.text);r.menu.displayMenuBounds.mwidth=Math.max(r.menu.displayMenuBounds.mwidth,n.width);if(!p){r.context.fillText(v.text,t,s+2)}r.menu.displayMenuBounds.h=10+4;s+=10+4}}}function c(q,p){q.setLayer(p);var v=q.menu.displayMenu;if(v){var s=q.menu.displayMenuOrigin.x;var r=q.menu.displayMenuOrigin.y;var t=q.menu.displayMenuBounds.mwidth;q.SetShadow();var m={w:0,h:0};for(var n=0;n<v.items.length;n++){var u=v.items[n];if(u.selected){q.context.fillStyle="rgba(255, 187, 40, 0.8)"}else{q.context.fillStyle="rgba(111, 111, 111, 0.8)"}u.x=s;u.y=r+(n*16);u.w=t>0?t:96;u.h=16;q.context.fillRect(u.x,u.y,u.w,u.h);m.h+=u.h;m.w=u.w}}}function d(r,q){if(this.menu.displayMenu){var m=false;var s=this.menu.displayMenu;for(var n=0;n<s.items.length;n++){var p=s.items[n];if(b(p.x,p.y,p.w,p.h,r,q)){if(!p.selected){m=true}p.selected=true}else{if(p.selected){m=true}p.selected=false}}if(m){this.update()}}}function h(q,t,s){if(this.menu.displayMenu){var n=false;var u=this.menu.displayMenu;var m=-1;for(var p=0;p<u.items.length;p++){var r=u.items[p];if(b(r.x,r.y,r.w,r.h,t,s)){r.selected=true;m=p}else{r.selected=false}}if(m>=0){this.HideMenu();console.log("menu item: "+m);this.update();return true}}return false}function b(m,s,n,r,q,p){return(m<q&&m+n>=q&&s<p&&s+r>=p)}truss_o.extendModule(l,"view.Menu",["view.Interface","core.Events","core.runtime"])}());(function(){function e(h){h.Events={};h.addEvent=d;h.addEventCallback=b;h.clearEventCallbacks=g;h.invokeEvent=c;h.addEventListener=a}function d(h){if(typeof this.Events[h]==="undefined"||this.Events[h]===null){this.Events[h]=new Array()}else{throw"the event "+h+" already registered"}}function b(h,i){if(typeof this.Events[h]==="undefined"||this.Events[h]===null){throw"the event "+h+" not registered"}else{this.Events[h].push(i)}}function g(h){if(typeof this.Events[h]==="undefined"||this.Events[h]===null){throw"the event "+h+" not registered"}else{this.Events[h]=new Array()}}function c(j,h){var l=this.Events[j];if(typeof l==="undefined"||l===null){throw"the event "+j+" not registered"}else{for(var k=0;k<l.length;k++){l[k].apply(this,h)}}}function a(j,h){var i=this;var k=this.canvas;if(j=="mouseup"){k=document}k.addEventListener(j,function(m,l,n){h.apply(i,[m,l,n])},false);this.log("registerd evt listener "+j)}truss_o.extendModule(e,"core.Events")}());(function(){function b(i){i.blurCanvas=function(){g(this.canvas,0,0,this.bounds.width,this.bounds.height,2)}}truss_o.extendModule(b,"extBlur","view.Interface");var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var h=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function d(q,n,p,i){var l=document.getElementById(q);var r=l.naturalWidth;var m=l.naturalHeight;var k=document.getElementById(n);k.style.width=r+"px";k.style.height=m+"px";k.width=r;k.height=m;var j=k.getContext("2d");j.clearRect(0,0,r,m);j.drawImage(l,0,0);if(isNaN(p)||p<1){return}if(i){g(n,0,0,r,m,p)}else{c(n,0,0,r,m,p)}}function g(s,O,M,j,l,X){if(isNaN(X)||X<1){return}X|=0;var ah=s.getContext("2d");var ac;try{try{ac=ah.getImageData(O,M,j,l)}catch(ag){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");ac=ah.getImageData(O,M,j,l)}catch(ag){alert("Cannot access local image");throw new Error("unable to access local image data: "+ag);return}}}catch(ag){alert("Cannot access image");throw new Error("unable to access image data: "+ag)}var r=ac.data;var V,U,ae,ab,C,F,w,n,q,L,aa,B,N,J,k,R,W,D,A,v,E,G,H,Q;var af=X+X+1;var S=j<<2;var z=j-1;var Z=l-1;var u=X+1;var Y=u*(u+1)/2;var P=new e();var K=P;for(ae=1;ae<af;ae++){K=K.next=new e();if(ae==u){var t=K}}K.next=P;var ad=null;var T=null;w=F=0;var I=a[X];var m=h[X];for(U=0;U<l;U++){R=W=D=A=n=q=L=aa=0;B=u*(v=r[F]);N=u*(E=r[F+1]);J=u*(G=r[F+2]);k=u*(H=r[F+3]);n+=Y*v;q+=Y*E;L+=Y*G;aa+=Y*H;K=P;for(ae=0;ae<u;ae++){K.r=v;K.g=E;K.b=G;K.a=H;K=K.next}for(ae=1;ae<u;ae++){ab=F+((z<ae?z:ae)<<2);n+=(K.r=(v=r[ab]))*(Q=u-ae);q+=(K.g=(E=r[ab+1]))*Q;L+=(K.b=(G=r[ab+2]))*Q;aa+=(K.a=(H=r[ab+3]))*Q;R+=v;W+=E;D+=G;A+=H;K=K.next}ad=P;T=t;for(V=0;V<j;V++){r[F+3]=H=(aa*I)>>m;if(H!=0){H=255/H;r[F]=((n*I)>>m)*H;r[F+1]=((q*I)>>m)*H;r[F+2]=((L*I)>>m)*H}else{r[F]=r[F+1]=r[F+2]=0}n-=B;q-=N;L-=J;aa-=k;B-=ad.r;N-=ad.g;J-=ad.b;k-=ad.a;ab=(w+((ab=V+X+1)<z?ab:z))<<2;R+=(ad.r=r[ab]);W+=(ad.g=r[ab+1]);D+=(ad.b=r[ab+2]);A+=(ad.a=r[ab+3]);n+=R;q+=W;L+=D;aa+=A;ad=ad.next;B+=(v=T.r);N+=(E=T.g);J+=(G=T.b);k+=(H=T.a);R-=v;W-=E;D-=G;A-=H;T=T.next;F+=4}w+=j}for(V=0;V<j;V++){W=D=A=R=q=L=aa=n=0;F=V<<2;B=u*(v=r[F]);N=u*(E=r[F+1]);J=u*(G=r[F+2]);k=u*(H=r[F+3]);n+=Y*v;q+=Y*E;L+=Y*G;aa+=Y*H;K=P;for(ae=0;ae<u;ae++){K.r=v;K.g=E;K.b=G;K.a=H;K=K.next}C=j;for(ae=1;ae<=X;ae++){F=(C+V)<<2;n+=(K.r=(v=r[F]))*(Q=u-ae);q+=(K.g=(E=r[F+1]))*Q;L+=(K.b=(G=r[F+2]))*Q;aa+=(K.a=(H=r[F+3]))*Q;R+=v;W+=E;D+=G;A+=H;K=K.next;if(ae<Z){C+=j}}F=V;ad=P;T=t;for(U=0;U<l;U++){ab=F<<2;r[ab+3]=H=(aa*I)>>m;if(H>0){H=255/H;r[ab]=((n*I)>>m)*H;r[ab+1]=((q*I)>>m)*H;r[ab+2]=((L*I)>>m)*H}else{r[ab]=r[ab+1]=r[ab+2]=0}n-=B;q-=N;L-=J;aa-=k;B-=ad.r;N-=ad.g;J-=ad.b;k-=ad.a;ab=(V+(((ab=U+u)<Z?ab:Z)*j))<<2;n+=(R+=(ad.r=r[ab]));q+=(W+=(ad.g=r[ab+1]));L+=(D+=(ad.b=r[ab+2]));aa+=(A+=(ad.a=r[ab+3]));ad=ad.next;B+=(v=T.r);N+=(E=T.g);J+=(G=T.b);k+=(H=T.a);R-=v;W-=E;D-=G;A-=H;T=T.next;F+=j}}ah.putImageData(ac,O,M)}function c(R,L,J,j,k,V){if(isNaN(V)||V<1){return}V|=0;var r=document.getElementById(R);var ae=r.getContext("2d");var Z;try{try{Z=ae.getImageData(L,J,j,k)}catch(ad){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");Z=ae.getImageData(L,J,j,k)}catch(ad){alert("Cannot access local image");throw new Error("unable to access local image data: "+ad);return}}}catch(ad){alert("Cannot access image");throw new Error("unable to access image data: "+ad)}var q=Z.data;var T,S,ab,Y,A,D,v,m,n,I,w,K,G,O,U,B,u,C,E,N;var ac=V+V+1;var P=j<<2;var z=j-1;var X=k-1;var t=V+1;var W=t*(t+1)/2;var M=new e();var H=M;for(ab=1;ab<ac;ab++){H=H.next=new e();if(ab==t){var s=H}}H.next=M;var aa=null;var Q=null;v=D=0;var F=a[V];var l=h[V];for(S=0;S<k;S++){O=U=B=m=n=I=0;w=t*(u=q[D]);K=t*(C=q[D+1]);G=t*(E=q[D+2]);m+=W*u;n+=W*C;I+=W*E;H=M;for(ab=0;ab<t;ab++){H.r=u;H.g=C;H.b=E;H=H.next}for(ab=1;ab<t;ab++){Y=D+((z<ab?z:ab)<<2);m+=(H.r=(u=q[Y]))*(N=t-ab);n+=(H.g=(C=q[Y+1]))*N;I+=(H.b=(E=q[Y+2]))*N;O+=u;U+=C;B+=E;H=H.next}aa=M;Q=s;for(T=0;T<j;T++){q[D]=(m*F)>>l;q[D+1]=(n*F)>>l;q[D+2]=(I*F)>>l;m-=w;n-=K;I-=G;w-=aa.r;K-=aa.g;G-=aa.b;Y=(v+((Y=T+V+1)<z?Y:z))<<2;O+=(aa.r=q[Y]);U+=(aa.g=q[Y+1]);B+=(aa.b=q[Y+2]);m+=O;n+=U;I+=B;aa=aa.next;w+=(u=Q.r);K+=(C=Q.g);G+=(E=Q.b);O-=u;U-=C;B-=E;Q=Q.next;D+=4}v+=j}for(T=0;T<j;T++){U=B=O=n=I=m=0;D=T<<2;w=t*(u=q[D]);K=t*(C=q[D+1]);G=t*(E=q[D+2]);m+=W*u;n+=W*C;I+=W*E;H=M;for(ab=0;ab<t;ab++){H.r=u;H.g=C;H.b=E;H=H.next}A=j;for(ab=1;ab<=V;ab++){D=(A+T)<<2;m+=(H.r=(u=q[D]))*(N=t-ab);n+=(H.g=(C=q[D+1]))*N;I+=(H.b=(E=q[D+2]))*N;O+=u;U+=C;B+=E;H=H.next;if(ab<X){A+=j}}D=T;aa=M;Q=s;for(S=0;S<k;S++){Y=D<<2;q[Y]=(m*F)>>l;q[Y+1]=(n*F)>>l;q[Y+2]=(I*F)>>l;m-=w;n-=K;I-=G;w-=aa.r;K-=aa.g;G-=aa.b;Y=(T+(((Y=S+t)<X?Y:X)*j))<<2;m+=(O+=(aa.r=q[Y]));n+=(U+=(aa.g=q[Y+1]));I+=(B+=(aa.b=q[Y+2]));aa=aa.next;w+=(u=Q.r);K+=(C=Q.g);G+=(E=Q.b);O-=u;U-=C;B-=E;Q=Q.next;D+=j}}ae.putImageData(Z,L,J)}function e(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}}());(function(){function b(h){h.blurCanvas=function(){e(this.context,0,0,this.bounds.width,this.bounds.height,2,1)}}truss_o.extendModule(b,"extBlur","view.Interface");var a=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1];var g=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];function d(r,p,q,i,l){var m=document.getElementById(r);var s=m.naturalWidth;var n=m.naturalHeight;var k=document.getElementById(p);k.style.width=s+"px";k.style.height=n+"px";k.width=s;k.height=n;var j=k.getContext("2d");j.clearRect(0,0,s,n);j.drawImage(m,0,0);if(isNaN(q)||q<1){return}if(i){c(p,0,0,s,n,q,l)}else{e(p,0,0,s,n,q,l)}}function c(X,D,C,h,k,I,M){if(isNaN(I)||I<1){return}I|=0;if(isNaN(M)){M=1}M|=0;if(M>3){M=3}if(M<1){M=1}var L;try{try{L=X.getImageData(D,C,h,k)}catch(S){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");L=X.getImageData(D,C,h,k)}catch(S){alert("Cannot access local image");throw new Error("unable to access local image data: "+S);return}}}catch(S){alert("Cannot access image");throw new Error("unable to access image data: "+S);return}var q=L.data;var n,F,E,s,H,G,N,K,T,R,u,w,t,U,A;var j=h-1;var Q=k-1;var l=h*k;var z=I+1;var B=a[I];var m=g[I];var J=[];var P=[];var V=[];var W=[];var v=[];var O=[];while(M-->0){t=w=0;for(G=0;G<k;G++){n=q[t]*z;F=q[t+1]*z;E=q[t+2]*z;s=q[t+3]*z;for(N=1;N<=I;N++){K=t+(((N>j?j:N))<<2);n+=q[K++];F+=q[K++];E+=q[K++];s+=q[K]}for(H=0;H<h;H++){J[w]=n;P[w]=F;V[w]=E;W[w]=s;if(G==0){v[H]=((K=H+z)<j?K:j)<<2;O[H]=((K=H-I)>0?K<<2:0)}T=t+v[H];R=t+O[H];n+=q[T++]-q[R++];F+=q[T++]-q[R++];E+=q[T++]-q[R++];s+=q[T]-q[R];w++}t+=(h<<2)}for(H=0;H<h;H++){u=H;n=J[u]*z;F=P[u]*z;E=V[u]*z;s=W[u]*z;for(N=1;N<=I;N++){u+=(N>Q?0:h);n+=J[u];F+=P[u];E+=V[u];s+=W[u]}w=H<<2;for(G=0;G<k;G++){q[w+3]=A=(s*B)>>>m;if(A>0){A=255/A;q[w]=((n*B)>>>m)*A;q[w+1]=((F*B)>>>m)*A;q[w+2]=((E*B)>>>m)*A}else{q[w]=q[w+1]=q[w+2]=0}if(H==0){v[G]=((K=G+z)<Q?K:Q)*h;O[G]=((K=G-I)>0?K*h:0)}T=H+v[G];R=H+O[G];n+=J[T]-J[R];F+=P[T]-P[R];E+=V[T]-V[R];s+=W[T]-W[R];w+=h<<2}}}X.putImageData(L,D,C)}function e(m,T,R,J,D,q,N){if(isNaN(q)||q<1){return}q|=0;if(isNaN(N)){N=1}N|=0;if(N>3){N=3}if(N<1){N=1}var Q;try{try{Q=m.getImageData(T,R,J,D)}catch(S){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");Q=m.getImageData(T,R,J,D)}catch(S){alert("Cannot access local image");throw new Error("unable to access local image data: "+S);return}}}catch(S){alert("Cannot access image");throw new Error("unable to access image data: "+S);return}var E=Q.data;var l,z,K,C,w,v,M,F,k,h,P,V,I,B;var n=J-1;var j=D-1;var t=J*D;var G=q+1;var A=[];var O=[];var U=[];var L=a[q];var H=g[q];var s=[];var u=[];while(N-->0){I=V=0;for(v=0;v<D;v++){l=E[I]*G;z=E[I+1]*G;K=E[I+2]*G;for(M=1;M<=q;M++){F=I+(((M>n?n:M))<<2);l+=E[F++];z+=E[F++];K+=E[F++]}for(w=0;w<J;w++){A[V]=l;O[V]=z;U[V]=K;if(v==0){s[w]=((F=w+G)<n?F:n)<<2;u[w]=((F=w-q)>0?F<<2:0)}k=I+s[w];h=I+u[w];l+=E[k++]-E[h++];z+=E[k++]-E[h++];K+=E[k++]-E[h++];V++}I+=(J<<2)}for(w=0;w<J;w++){P=w;l=A[P]*G;z=O[P]*G;K=U[P]*G;for(M=1;M<=q;M++){P+=(M>j?0:J);l+=A[P];z+=O[P];K+=U[P]}V=w<<2;for(v=0;v<D;v++){E[V]=(l*L)>>>H;E[V+1]=(z*L)>>>H;E[V+2]=(K*L)>>>H;if(w==0){s[v]=((F=v+G)<j?F:j)*J;u[v]=((F=v-q)>0?F*J:0)}k=w+s[v];h=w+u[v];l+=A[k]-A[h];z+=O[k]-O[h];K+=U[k]-U[h];V+=J<<2}}}m.putImageData(Q,T,R)}}());(function(){function e(g){g.runtime.inputEventOut="input_ge";g.runtime.inputEventPush="inpute_gp";g.addEvent(g.runtime.inputEventPush);g.addEvent(g.runtime.inputEventOut);g.PushEvent=c;g.DispatchEvent=b;g.addEventListener("keydown",a);g.canvas.focus();g.canvas.setAttribute("tabindex","0")}function c(h,g){this.invokeEvent(this.runtime.inputEventOut,[h,g])}function b(h,g){this.invokeEvent(this.runtime.inputEventOut,[h,g])}function d(){}function a(g){console.log("pressed "+g.keyCode+", ["+String.fromCharCode(g.keyCode)+"]");g.preventDefault()}truss_o.extendModule(e,"view.Input",["view.Interface","core.Events","core.runtime"])}());(function(){function a(k){k.vLayers=[];k.vCurrentLayer=undefined;k.CommonContext=undefined;k.CommonCanvas=undefined;k.addLayer=e;k.setLayer=j;k.saveLayer=d;k.drawLayer=b;k.invalidateLayer=h;k.hasLayerData=g;k.drawLayerPart=c}function e(n,l){var m=i(this,n);if(m<0){var p=document.createElement("canvas");p.width=this.bounds.width;p.height=this.bounds.height;var k=p.getContext("2d");if(l){document.body.appendChild(p)}this.vLayers.push({name:n,canvas:p,context:k,data:undefined})}else{throw"the layer "+n+" already exists"}}function j(l){if(this.vCurrentLayer===l){return false}if(typeof l==="undefined"){this.saveLayer();this.context=this.CommonContext;this.canvas=this.CommonCanvas;this.vCurrentLayer=undefined;return}var k=i(this,l);if(k<0){throw"layer "+l+" not found"}else{this.saveLayer();this.vCurrentLayer=l;this.context=this.vLayers[k].context;this.canvas=this.vLayers[k].canvas}}function d(){if(typeof this.vCurrentLayer==="undefined"){this.CommonContext=this.context;this.CommonCanvas=this.canvas;return}var k=i(this,this.vCurrentLayer);this.vLayers[k].data=this.GetCanvasData()}function b(l){var k=i(this,l);if(k<0){throw"layer "+l+" not found"}if(this.vLayers[k].data!=undefined){this.PutCanvasData(this.vLayers[k].data)}}function c(q,k,s,m,l,p,r){var n=i(this,q);if(n<0){throw"layer "+q+" not found"}this.PutCanvasDataPart(this.vLayers[n].data,k,s,m,l,p,r)}function h(l){var k=i(this,l);if(k<0){throw"layer "+l+" not found"}this.vLayers[k].data=undefined}function g(l){var k=i(this,l);if(k<0){throw"layer "+l+" not found"}return !(typeof this.vLayers[k].data==="undefined")}function i(k,l){for(var m=0;m<k.vLayers.length;m++){if(k.vLayers[m].name===l){return m}}return -1}truss_o.extendModule(a,"view.Layers","view.Interface")}());truss_o.option("test2","sayno");truss_o.say();truss_o.option("test2","world");truss_o.option("test3","sayno");truss_o.say();(function(){function e(r){r.objects=[];r.connections=[];r.conIndexes=[];r.AddObject=n;r.Connect=c;r.ConnectIndexes=h;r.NodeIndex=q;r.GetRelatedObjectsDeep=j;r.separateTwo=k;r.separateIfOneConnection=g;r.addEvent("NodeAdded");r.addEvent("NodeRemoved");r.addEvent("NodePropsChanged");r.addEvent("NodesSeparated");r.option("view.node.radius",10);r.exportData=d;r.importData=p;r.aabb={x:0,y:0,max_x:0,max_y:0,is_invalidate:false};r.addEvent("NodeDisposition");r.addEventCallback("NodeDisposition",m);r.NodeDisposition=a;r.objs_translate={xoffset:0,yoffset:0};r.setProps=b;r.setPropsI=i}function m(r){this.aabb.x=this.aabb.y=16777215;this.aabb.max_x=this.aabb.max_y=0;this.aabb.is_invalidate=true}function a(r){this.aabb.x=Math.min(r.x-this.options.view.node.radius+this.objs_translate.xoffset,this.aabb.x);this.aabb.y=Math.min(r.y-this.options.view.node.radius+this.objs_translate.yoffset,this.aabb.y);this.aabb.max_x=Math.max(r.x+this.options.view.node.radius+this.objs_translate.xoffset,this.aabb.max_x);this.aabb.max_y=Math.max(r.y+this.options.view.node.radius+this.objs_translate.yoffset,this.aabb.max_y)}function n(s,r,u,t){if(typeof t==="undefined"){t={}}t.name=s;t.x=typeof r==="undefined"||(r===null?0:r);t.y=typeof u==="undefined"||(r===null?0:u);this.objects.push(t);this.invokeEvent("NodeAdded");return this.objects.length-1}function c(u,t){var s=this.NodeIndex(u);var r=this.NodeIndex(t);if(s<0||r<0){throw"the nodes for connection not found"}if(s===r){return false}if(l(this,s,r)){return false}this.connections.push([u,t]);this.conIndexes.push([s,r]);return true}function h(s,r){if(s<0||this.objects.length<=s||r<0||this.objects.length<=r){throw"the nodes indexes out of bounds"}if(s===r||l(this,s,r)){return false}this.connections.push([this.objects[s].name,this.objects[r].name]);this.conIndexes.push([s,r]);return true}function l(u,t,s){for(var r=0;r<u.conIndexes.length;r++){if((u.conIndexes[r][0]===t||u.conIndexes[r][0]===s)&&(u.conIndexes[r][1]===t||u.conIndexes[r][1]===s)){return true}}return false}function q(r){for(var s=0;s<this.objects.length;s++){if(this.objects[s].name===r){return s}}return -1}function j(u){var r=[u];for(var s=0;s<r.length;s++){for(var t=0;t<this.conIndexes.length;t++){if(this.conIndexes[t][0]==r[s]&&r.indexOf(this.conIndexes[t][1])<0){r.push(this.conIndexes[t][1])}}}return r}function d(){var r={version:this.version,clientDate:Date()};r.objects=[];for(var s=0;s<this.objects.length;s++){r.objects.push({name:this.objects[s].name,x:this.objects[s].x,y:this.objects[s].y,label:this.objects[s].label,labelRight:this.objects[s].labelRight})}r.connections=this.conIndexes;return r}function p(r){if(typeof r.objects==="object"&&r.objects.length>=0&&typeof r.connections==="object"&&r.connections.length>=0){this.objects=r.objects;this.conIndexes=r.connections;this.update()}}function b(t,s,r){this.setPropsI(this.FindNode(t),s,r)}function i(t,s,r){this.objects[t].label=s;this.objects[t].labelRight=r;this.invokeEvent("NodePropsChanged",[t]);this.PushEvent("NodeProps",[t,s,r])}function g(x){var w=this;var t=0;var v=-1;for(var u=0;u<w.conIndexes.length;u++){if(w.conIndexes[u][0]===x||w.conIndexes[u][1]===x){t++;v=u}}if(t==1){var s=w.conIndexes[v][0];var r=w.conIndexes[v][1];this.conIndexes.splice(v,1);this.invokeEvent("NodesSeparated",[s,r]);return true}return false}function k(s,r){var v=this;var u=-1;for(var t=0;t<v.conIndexes.length;t++){if((v.conIndexes[t][0]===s&&v.conIndexes[t][1]===r)||(v.conIndexes[t][1]===s&&v.conIndexes[t][0]===r)){u=t;break}}if(u>=0){this.conIndexes.splice(u,1);this.invokeEvent("NodesSeparated",[s,r]);return true}return false}truss_o.extendModule(e,"objects.Tree","core.Events")}());(function(){function a(b){b.runtime={}}truss_o.extendModule(a,"core.runtime")}());(function(){function l(m){m.mouseDragContext={startX:0,startY:0};m.selectedNode=-1;m.Dragging=false;m.FieldDragging=false;m.FieldDraggingPos={startX:0,startY:0,prevX:0,prevY:0};m.moveNodeTo=i;m.DragList=[];m.DeltasMeasuring=[];m.addEventListener("mousedown",e);m.addEventListener("mouseup",a);m.addEventListener("mousemove",k);m.addEvent("MouseDragDelta");m.addEvent("nodeSelected");m.addEvent("nodeFocusLost");m.addEventCallback("Render",d);m.addDeltaMeasuring=g;m.CreateTimer(30,c);m.canvas.oncontextmenu=function(){if(typeof m.menu.displayMenu==="undefined"&&m.selectedNode>=0){m.ShowMenu("test",m.objects[m.selectedNode].x,m.objects[m.selectedNode].y)}return false}}function c(){for(var n=0;n<this.DeltasMeasuring.length;n++){var m=this.DeltasMeasuring[n];if(m[0]>=m[1]){m[2].call(this);m[0]=0}}}function g(m,n){this.DeltasMeasuring.push([0,m,n]);return this.DeltasMeasuring.length-1}function h(){}function j(m){}function e(p){console.log("mdown");if(this.Dragging){return}if(p.which==1||p.which==3){this.updateBounds();var s=-1;var r=p.pageX-this.bounds.left;var n=p.pageY-this.bounds.top;if(this.menu.displayMenu){if(this.processInteractionMMdown(p.which,r,n)){return}}var q=false;for(var m=0;m<this.objects.length;m++){if(b(this.objects[m].x+this.objs_translate.xoffset,this.objects[m].y+this.objs_translate.yoffset,this.options.view.node.radius,r,n)){if(this.selectedNode===m){q=true;continue}q=false;this.invokeEvent("nodeFocusLost",[this.selectedNode,m,this.objects[this.selectedNode]]);s=m;this.invokeEvent("nodeSelected",[s,this.objects[m]]);break}}if(s<0){this.invokeEvent("nodeFocusLost",[this.selectedNode,-1,this.objects[this.selectedNode]])}if(!q){this.selectedNode=s}if(p.which==1){this.HideMenu();if(this.selectedNode>=0){this.Dragging=true;this.DragList=this.GetRelatedObjectsDeep(this.selectedNode);for(var m=0;m<this.DragList.length;m++){o=this.objects[this.DragList[m]];o.targetX=0;o.targetY=0;o.dragOn=false}this.mouseDragContext.startX=r-this.objects[this.selectedNode].x-this.objs_translate.xoffset;this.mouseDragContext.startY=n-this.objects[this.selectedNode].y-this.objs_translate.yoffset;this.objects[this.selectedNode].dragOn=false;this.objects[this.selectedNode].targetX=0;this.objects[this.selectedNode].targetY=0}this.FieldDragging=s==-1;if(this.FieldDragging){this.FieldDraggingPos.startX=r;this.FieldDraggingPos.startY=n;this.FieldDraggingPos.prevX=this.objs_translate.xoffset;this.FieldDraggingPos.prevY=this.objs_translate.yoffset}this.update()}else{if(this.selectedNode>=0){this.ShowMenu("test",r,n)}else{this.HideMenu()}}}this.canvas.focus()}function a(m){console.log("mup");if(m.which==1){if(this.FieldDragging){this.FieldDragging=false}if(this.Dragging){this.Dragging=false;if(this.selectedNode>=0){this.PushEvent("moved",[this.selectedNode,this.objects[this.selectedNode].x,this.objects[this.selectedNode].y])}}}m.preventDefault()}function k(s){var t=s.pageX-this.bounds.left;var r=s.pageY-this.bounds.top;if(this.Dragging){this.moveNodeTo(this.selectedNode,t-this.objs_translate.xoffset-this.mouseDragContext.startX,r-this.objs_translate.yoffset-this.mouseDragContext.startY);this.update()}else{if(this.FieldDragging){var n=t-this.FieldDraggingPos.startX;var m=r-this.FieldDraggingPos.startY;this.objs_translate.xoffset=n+this.FieldDraggingPos.prevX;this.objs_translate.yoffset=m+this.FieldDraggingPos.prevY;var q=Math.sqrt(Math.pow(n,2)+Math.pow(m,2));for(var p=0;p<this.DeltasMeasuring.length;p++){this.DeltasMeasuring[p][0]+=q}this.update()}}this.processInteractionMMove(t,r);s.preventDefault()}function b(n,t,m,s,r){var q=n-s;var p=t-r;return(q*q+p*p<m*m*4)}function i(p,n,m){this.objects[p].targetX=n;this.objects[p].targetY=m;this.objects[p].dragOn=true}function d(){var t=0;var r=0;if(this.selectedNode>=0){this.objects[this.selectedNode].needDrag=(Math.abs(this.objects[this.selectedNode].x-this.objects[this.selectedNode].targetX)>0.1)||(Math.abs(this.objects[this.selectedNode].y-this.objects[this.selectedNode].targetY)>0.1);if(this.objects[this.selectedNode].needDrag&&this.objects[this.selectedNode].dragOn){var n=0.4*(this.objects[this.selectedNode].targetX-this.objects[this.selectedNode].x);var m=0.4*(this.objects[this.selectedNode].targetY-this.objects[this.selectedNode].y);this.objects[this.selectedNode].x=this.objects[this.selectedNode].x+n;this.objects[this.selectedNode].y=this.objects[this.selectedNode].y+m;for(var q=1;q<this.DragList.length;q++){var p=this.DragList[q];this.objects[p].x+=n;this.objects[p].y+=m}t=Math.max(t,Math.abs(n));r=Math.max(r,Math.abs(m))}}if(t>0||r>0){var s=Math.sqrt(Math.pow(t,2)+Math.pow(r,2));for(var q=0;q<this.DeltasMeasuring.length;q++){this.DeltasMeasuring[q][0]+=s}}}truss_o.extendModule(l,"view.Structure",["view.Input","core.Events","core.Animate","objects.Tree","view.Interface","view.Menu"])}());(function(){function q(u){p(u);u.updateBounds=function(){p(u)};u.ViewEngines=[];u.CViewEnginesName=[];u.CViewEngines=[];u.addViewEngine=k;u.setViewEngine=l;u.FindViewEngine=j;u.Clear=t;u.ClearRect=c;u.GetCanvasData=a;u.PutCanvasData=h;u.PutCanvasDataPart=m;u.SetShadow=d;u.drawArrow=e;u.addEventCallback("NodeAdded",r);u.addEventCallback("NodesSeparated",n);u.addEventCallback("Render",s);u.addEventCallback("update",i)}function p(u){u.bounds={width:u.canvas.width,height:u.canvas.height,left:$(u.canvas).position().left,top:$(u.canvas).position().top}}function k(u,w){var v=this.FindViewEngine(u);if(v<0){this.ViewEngines.push({name:u,iface:w})}else{throw"the view engine "+u+" already registered"}}function l(u){var v=this.FindViewEngine(u);if(v<0){throw"the view interface "+u+" not found"}if(this.CViewEnginesName.indexOf(this.ViewEngines[v].name)<0){this.CViewEnginesName.push(this.ViewEngines[v].name);this.CViewEngines.push(this.ViewEngines[v].iface)}else{throw"the view interface "+u+" already enabled"}}function j(u){for(var v=0;v<this.ViewEngines.length;v++){if(this.ViewEngines[v].name===u){return v}}return -1}function t(){this.context.clearRect(0,0,this.bounds.width,this.bounds.height)}function c(u){this.context.clearRect(u.x,u.y,u.width,u.height)}function a(){var u=this.canvas;return u}function h(u){this.context.drawImage(u,0,0)}function m(C,u,B,w,v,z,A){this.context.drawImage(C,u,B,w,v,z,A)}function r(v,u){this.update()}function n(v,u){this.update()}function b(u,x){var w;for(var v=0;v<u.CViewEngines.length;v++){w=u.CViewEngines[v];if(typeof w==="undefined"){continue}w[x].call(u)}}function d(u,x,w,v){if(typeof u==="undefined"){this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowBlur=0;this.context.shadowColor=0}else{this.context.shadowOffsetX=u;this.context.shadowOffsetY=x;this.context.shadowBlur=w;this.context.shadowColor=v}}function i(){b(this,"update")}function s(){b(this,"Render")}function e(J,x,H,w,I,D,K,M){I=typeof(I)!="undefined"?I:3;D=typeof(D)!="undefined"?D:1;K=typeof(K)!="undefined"?K:Math.PI/8;M=typeof(M)!="undefined"?M:10;var F=typeof(I)!="function"?g:I;var E=Math.sqrt((H-J)*(H-J)+(w-x)*(w-x));var A=(E-M/3)/E;var C,B,N,L;if(D&1){C=J+(H-J)*A;B=x+(w-x)*A}else{C=H;B=w}if(D&2){N=J+(H-J)*(1-A);L=x+(w-x)*(1-A)}else{N=J;L=x}this.context.beginPath();this.context.moveTo(N,L);this.context.lineTo(C,B);this.context.stroke();var Q=Math.atan2(w-x,H-J);var G=Math.abs(M/Math.cos(K));if(D&1){var v=Q+Math.PI+K;var z=H+Math.cos(v)*G;var y=w+Math.sin(v)*G;var u=Q+Math.PI-K;var P=H+Math.cos(u)*G;var O=w+Math.sin(u)*G;F(this.context,z,y,H,w,P,O,I)}if(D&2){var v=Q+K;var z=J+Math.cos(v)*G;var y=x+Math.sin(v)*G;var u=Q-K;var P=J+Math.cos(u)*G;var O=x+Math.sin(u)*G;F(this.context,z,y,J,x,P,O,I)}}function g(G,O,y,M,w,J,u,K){G.beginPath();G.moveTo(O,y);G.lineTo(M,w);G.lineTo(J,u);G.stroke();switch(K){case 0:var Q=Math.sqrt(((J-O)*(J-O))+((u-y)*(u-y)));G.arcTo(M,w,O,y,0.55*Q);G.fill();break;case 1:G.lineTo(O,y);G.fill();break;case 2:G.stroke();break;case 3:var B=(O+M+J)/3;var z=(y+w+u)/3;G.quadraticCurveTo(B,z,O,y);G.fill();break;case 4:var N,L,x,v,Q;var E=5;if(J==O){Q=u-y;N=(M+O)/2;x=(M+O)/2;L=w+Q/E;v=w-Q/E}else{Q=Math.sqrt(((J-O)*(J-O))+((u-y)*(u-y)));var H=(O+J)/2;var A=(y+u)/2;var I=(H+M)/2;var P=(A+w)/2;var F=(u-y)/(J-O);var D=(Q/(2*Math.sqrt(F*F+1)))/E;var C=F*D;N=I-D;L=P-C;x=I+D;v=P+C}G.bezierCurveTo(N,L,x,v,O,y);G.fill();break}}truss_o.extendModule(q,"view.Interface",["core.Events","core.Animate"])}());(function(){var g="dbg.background";var d="dbg.nodes";var e="dbg.text";var a="dbg.menu";function p(u){var v={Render:s,update:i};u.option("view.dbg.backgroundColor1","rgba(60, 78, 98, 1)");u.option("view.dbg.backgroundColor2","rgba(35, 47, 59, 1)");u.addViewEngine("Debug",v);u.setViewEngine("Debug");u.addLayer(g);u.addLayer(d);u.addLayer(e);u.addLayer(a);u.addEventCallback("MouseDragDelta",k);u.addEventCallback("NodePropsChanged",r);u.addDeltaMeasuring(2,q);u.runtime.InvalidateTextlayer=false;u.aabb={x:23,y:44,max_x:66,max_y:88};u.setBackground=c;u.AddDisplayMenu("test",{items:[{text:"displaying add"},{text:"some sort of others"}]});u.CreateTimer(1000/30,h)}function l(u,w){u.SetShadow(0,0,6,"rgb(255, 255, 255)");for(var v=0;v<w.length;v++){f=w[v];if(!f.visible){continue}u.context.fillStyle="rgba(255, 255, 255, 0."+f.opacity+")";u.context.beginPath();u.context.arc(f.x,f.y,f.szR,0,2*Math.PI,false);u.context.closePath();u.context.fill()}}function h(){var u=this;if(typeof u.flexes==="undefined"){u.flexes={layblink:[],lay1:[],lay2:[],lay3:[],lastIteration:new Date(),lastIterationVis:new Date()};flexCnt=40;u.updateBounds();t(u.flexes.lay1,flexCnt,u.bounds);t(u.flexes.lay2,flexCnt,u.bounds);t(u.flexes.layblink,flexCnt,u.bounds);t(u.flexes.lay3,flexCnt,u.bounds)}else{b(u.flexes.lay1,u.bounds);b(u.flexes.lay2,u.bounds);b(u.flexes.layblink,u.bounds);b(u.flexes.lay3,u.bounds);if((new Date())-u.flexes.lastIterationVis>1000){n(u.flexes.layblink);u.flexes.lastIterationVis=new Date()}u.flexes.lastIteration=Date();u.update()}}function b(v,w){for(var u=0;u<v.length;u++){var x=v[u];x.x+=x.stepx;x.y+=x.stepy;if(x.x>w.width){x.x=0}if(x.y>w.height){x.y=0}if(x.x<0){x.x=w.width}}}function n(v){for(var u=0;u<v.length;u++){f=v[u];f.visible=j(1,20)!=10}}function t(w,u,x){for(var v=0;v<u;v++){var y={visible:true,szR:j(2,8),x:j(0,x.width),y:j(0,x.height),stepx:j(-1,3),stepy:j(1,3),opacity:j(1,10)};if(y.stepx==0){y.stepx=1}w.push(y)}}function j(v,u){return v+Math.floor((Math.random()*(u-v)+1))}function i(){this.invalidateLayer(e);this.invalidateLayer(a)}function r(){this.update()}function c(v,u){if(typeof v!="undefined"){this.options.view.dbg.backgroundColor1=v}if(typeof u!="undefined"){this.options.view.dbg.backgroundColor2=u}this.invalidateLayer(g);this.update()}function m(u){u.SetShadow();u.context.lineWidth=1;u.context.strokeStyle="#FaFaFa";u.context.strokeRect(u.aabb.x,u.aabb.y,u.aabb.max_x-u.aabb.x,u.aabb.max_y-u.aabb.y)}function q(){this.runtime.InvalidateTextlayer=true}function s(){if(this.hasLayerData(g)){this.setLayer();this.Clear();this.SetShadow();this.drawLayer(g)}else{this.setLayer(g);this.dbgview={};this.dbgview.gradientBackground=this.context.createRadialGradient(280,320,0,300,300,500);this.dbgview.gradientBackground.addColorStop(0,this.options.view.dbg.backgroundColor1);this.dbgview.gradientBackground.addColorStop(1,this.options.view.dbg.backgroundColor2);this.context.fillStyle=this.dbgview.gradientBackground;this.context.fillRect(0,0,this.bounds.width,this.bounds.height);this.saveLayer();this.setLayer();this.drawLayer(g)}this.context.font="8pt Verdana";this.SetShadow();this.setLayer();if(typeof this.flexes!="undefined"){l(this,this.flexes.lay1);l(this,this.flexes.layblink);l(this,this.flexes.lay2);l(this,this.flexes.lay3)}this.context.fillStyle="rgb(255, 255, 255)";this.aabb={x:16777215,y:16777215,max_x:-16777215,max_y:-16777215};this.context.fillText(this.fps.rate.toFixed(2)+" fps",14,14);this.setLayer(d);this.Clear();this.context.translate(this.objs_translate.xoffset,this.objs_translate.yoffset);this.SetShadow();this.context.fillStyle="rgb(255, 255, 255)";for(var C=0;C<this.conIndexes.length;C++){var G=0;var v=0;var F=0;var u=0;G=this.objects[this.conIndexes[C][0]].x;v=this.objects[this.conIndexes[C][0]].y;F=this.objects[this.conIndexes[C][1]].x;u=this.objects[this.conIndexes[C][1]].y;var E=4;var z=this.options.view.node.radius;var L=F-G;var K=u-v;var I=Math.sqrt(Math.pow(L,2)+Math.pow(K,2));var B=z/I;var J=F-(B*L);var H=u-(B*K);var G=G+(B*L);var v=v+(B*K);this.drawArrow(G,v,J,H,3,1,Math.PI/4,E)}this.SetShadow(2,2,6,"rgba(0, 0, 0, 0.8)");for(var C=0;C<this.objects.length;C++){this.context.lineWidth=0.5;if(this.selectedNode==C){this.context.fillStyle="rgba(68, 110, 150, 0.6)"}else{this.context.fillStyle="rgba(0, 0, 0, 0.3)"}this.context.strokeStyle="#FFFFFF";this.context.beginPath();this.context.arc(this.objects[C].x,this.objects[C].y,this.options.view.node.radius,0,2*Math.PI,false);this.context.closePath();this.context.fill();this.context.stroke();this.NodeDisposition(this.objects[C])}if(this.aabb.is_invalidate){this.aabb.is_invalidate=false}this.context.translate(-this.objs_translate.xoffset,-this.objs_translate.yoffset);m(this);this.saveLayer();this.setLayer();this.SetShadow();this.drawLayer(d);if(!this.runtime.InvalidateTextlayer&&this.hasLayerData(e)){}else{this.runtime.InvalidateTextlayer=false;this.setLayer(e);this.Clear();this.context.font="9pt Verdana";this.SetShadow();this.context.translate(this.objs_translate.xoffset,this.objs_translate.yoffset);this.context.fillStyle="rgb(255, 255, 255)";for(var C=0;C<this.objects.length;C++){if(this.objects[C].label!=undefined){var D=this.context.measureText(this.objects[C].label);var A=this.objects[C].x-this.options.view.node.radius-D.width-4;var w=this.objects[C].y+this.options.view.node.radius*0.5;this.context.fillText(this.objects[C].label,A,w)}if(this.objects[C].labelRight!=undefined){this.context.fillText(this.objects[C].labelRight,this.objects[C].x+this.options.view.node.radius+4,this.objects[C].y+this.options.view.node.radius*0.5)}}this.context.translate(-this.objs_translate.xoffset,-this.objs_translate.yoffset);this.saveLayer()}if(!this.hasLayerData(a)){this.setLayer(a);this.Clear();this.RenderDisplayMenuText(a,true);this.RenderDisplayMenuBackground(a);this.RenderDisplayMenuText(a);this.saveLayer()}this.setLayer();this.SetShadow();this.drawLayer(e);this.drawLayer(a)}function k(u,v){}truss_o.extendModule(p,"view.Debug",["view.Interface","view.Layers","objects.Tree","view.Structure","core.runtime","view.Menu","extBlur"])}());
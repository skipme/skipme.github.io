var truss_o;(function(){var j={test:"hello",test2:"world"};var i=function(m){console.log(m)};var h=[];function f(o,p,q){if(o.indexOf(".")===-1){if(q||(this.options[o]===null||typeof this.options[o]==="undefined")){this.options[o]=p}}else{var r=o.split(".");var m=this.options;for(var n=0;n<r.length-1;n++){if(r[n]===null||typeof r[n]==="undefined"){throw"The property path not well formed: "+o+" defaultval: "+p}if(typeof m[r[n]]==="undefined"){m[r[n]]={}}m=m[r[n]]}m[r[r.length-1]]=p}}function l(m,n,o){h.push({name:n,after:o,foo:m})}function c(n,m){return n+Math.floor((Math.random()*(m-n)+1))}function k(q){if(!q||"object"!==typeof q){return q}var r="function"===typeof q.pop?[]:{};var n,m;for(n in q){if(q.hasOwnProperty(n)){m=q[n];if(m&&"object"===typeof m){r[n]=k(m)}else{r[n]=m}}}return r}function a(m){var n=k(this);n.canvas=m;n.context=m.getContext("2d");e(n);delete n.create;delete n.extendModule;return n}function e(n){var m;var o=0;while(!m){m=g(n);if(!m){if(n.options.registered.length==o){throw"missed some module"}}o=n.options.registered.length}i("extended by "+h.length+" modules")}function g(p){var m=true;p.option("registered",new Array());var r=p.options.registered;for(var o=0;o<h.length;o++){if(r.indexOf(h[o].name)>=0){continue}var q=true;if(typeof h[o].after==="string"){if(r.indexOf(h[o].after)>=0){q=true}else{q=false}}else{if(typeof h[o].after==="object"){q=true;for(var n=0;n<h[o].after.length;n++){if(r.indexOf(h[o].after[n])<0){q=false;break}}}else{if(typeof h[o].after==="undefined"){q=true}}}if(q){h[o].foo(p);r.push(h[o].name);i("extended by "+h[o].name)}else{m=false}}return m}function d(){i(this.options.test+" "+this.options.test2)}function b(m){var n={};return m&&n.toString.call(m)==="[object Function]"}uuid=(function(){var m="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(n,s){var u=m,q=[],p=Math.random;s=s||u.length;if(n){for(var o=0;o<n;o++){q[o]=u[0|p()*s]}}else{var t;q[8]=q[13]=q[18]=q[23]="-";q[14]="4";for(var o=0;o<36;o++){if(!q[o]){t=0|p()*16;q[o]=u[(o==19)?(t&3)|8:t&15]}}}return q.join("")}})();truss_o={version:"0.1 devTool",options:j,option:f,say:d,rndm:c,extendModule:l,create:a,isFunction:b,uuid:uuid,log:i};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(m){window.setTimeout(m,1000/60)}})()}());(function(){var g=10;function f(i){i.fps={};i.fps.rate=0;i.fps.now=0;i.fps.lastUpdate=(new Date())*1-1;i.addEvent("Render");i.addEvent("update");i.StopAnim=false;i.SuspendFrame=false;i.animFrame=d;i.option("animFps",30);i.animFPS=0;e(i);i.timers=[];i.CreateTimer=c;i.uselessFrames=500;i.suspendAnimation=a;i.update=h}function d(i){i.fps.now=new Date();var j=1000/(i.fps.now-i.fps.lastUpdate);if(isNaN(j)){j=0.1}i.fps.rate+=(j-i.fps.rate)/g;if(isNaN(i.fps.rate)){i.fps.rate=0.1}i.fps.lastUpdate=i.fps.now;if(!i.StopAnim){if(i.uselessFrames<=-5){i.suspendAnimation()}i.invokeEvent("Render");i.uselessFrames--}}function c(j,l){var i=this;var k=setInterval(function(){l.call(i)},j);this.timers.push(k)}function b(i){i.animFrame(i)}function e(i){b(i);if(!i.SuspendFrame){requestAnimFrame(function(){e(i)})}}function a(){this.SuspendFrame=true}function h(){if(this.SuspendFrame){this.SuspendFrame=false;this.uselessFrames=30;e(this);console.log("frame loop-->")}else{this.uselessFrames=30}this.invokeEvent("update")}truss_o.extendModule(f,"core.Animate",["core.Events","core.runtime"])}());(function(){function c(g){g.Button={buttons:[{x:0,y:0,w:0,h:0,visible:1,interaction:f,focus:0,hover:false,switched:false,render:a,caption:"OK",font:"12px Verdana",fontheight:12}],buttonNames:[]};g.addButton=b}function e(g,h){g.context.font=h.font;g.context.textBaseline="bottom";g.context.textAlign="start";if(h.hover){g.SetShadow(0,0,4,h.hovercolor)}else{g.SetShadow()}g.context.fillStyle=(h.hover||h.focus)?"rgba(255, 255, 255, 1)":"rgba(111, 111, 111, 1)"}function a(g){var h=this;g.SetShadow();if(h.drawbackground){g.context.fillStyle="rgba(37, 51, 62, .8)";g.context.fillRect(h.x,h.y,h.w,h.h)}e(g,h);g.context.fillText(h.caption,h.x+2,h.y+h.h-2);g.SetShadow()}function f(j,h,l,g,i,o){if(o!==null){var k=o;var n=j.runtime.mx;var m=j.runtime.my;if(this.hover=d(this.x,this.y,this.w,this.h,n,m)){j.setCursor("pointer")}}else{if(i!==null){var k=i;var n=j.runtime.mx;var m=j.runtime.my;if(d(this.x,this.y,this.w,this.h,n,m)){if(typeof this.callback!=="undefined"&&j.isFunction(this.callback)){this.callback.call()}}}else{if(h!==null&&this.focus){if(h.keyCode===13){if(typeof this.callback!=="undefined"&&j.isFunction(this.callback)){this.callback.call()}}}}}}function d(g,m,i,l,k,j){return(g<k&&g+i>=k&&m<j&&m+l>=j)}function b(i,h,g,k,l){this.Button.buttonNames[i]=this.Button.buttons.length;var j={x:0,y:0,w:0,h:0,visible:1,interaction:f,focus:0,hover:false,switched:false,hovercolor:"rgb(40, 187, 255)",drawbackground:true,render:a,caption:h,font:g,fontheight:k,callback:l};this.Button.buttons.push(j);return j}truss_o.extendModule(c,"view.Button",["view.Interface","core.runtime"])}());(function(){function k(l){l.menu={menuList:[],displayMenuName:undefined,displayMenu:undefined,displayMenuOrigin:{x:0,y:0},displayMenuBounds:{mwidth:0,h:0}};l.RenderMenu=e;l.AddDisplayMenu=j;l.ShowMenu=function(n,m,p,o){h(this,n,m,p)};l.HideMenu=f;l.getActiveMenuName=function(){return this.menu.displayMenuName};l.processInteractionMMove=d;l.processInteractionMMdown=g}function f(){if(typeof this.menu.displayMenu==="undefined"){return}var m=this.menu.displayMenu;for(var l=0;l<m.items.length;l++){m.items[l].selected=false}this.menu.displayMenuName=undefined;this.menu.displayMenu=undefined;this.update()}function j(m,l){l.name=m;this.menu.menuList.push(l)}function a(l,m){for(var n=0;n<l.menu.menuList.length;n++){if(l.menu.menuList[n].name==m){return l.menu.menuList[n]}}return undefined}function h(m,n,l,p){var o=a(m,n);if(typeof o==="undefined"){return}m.menu.displayMenuName=n;m.menu.displayMenu=o;m.menu.displayMenuOrigin.x=l;m.menu.displayMenuOrigin.y=p;m.update()}function e(m,l){i(this,m,true);c(this,l);i(this,m,false)}function i(p,o,n){var s=p.menu.displayMenu;if(s){p.setLayer(o);p.SetShadow();p.context.font="8pt Verdana";p.context.textBaseline="top";p.context.textAlign="start";p.context.fillStyle="rgb(255, 255, 255)";var r=p.menu.displayMenuOrigin.x+4;var q=p.menu.displayMenuOrigin.y;for(var l=0;l<s.items.length;l++){var t=s.items[l];var m=p.context.measureText(t.text);p.menu.displayMenuBounds.mwidth=Math.max(p.menu.displayMenuBounds.mwidth,m.width+8);if(!n){p.context.fillText(t.text,r,q+=2)}p.menu.displayMenuBounds.h=10+4;q+=10+4}}}function c(o,n){o.setLayer(n);var t=o.menu.displayMenu;if(t){var q=o.menu.displayMenuOrigin.x;var p=o.menu.displayMenuOrigin.y;var r=o.menu.displayMenuBounds.mwidth;o.SetShadow();var l={w:0,h:0};for(var m=0;m<t.items.length;m++){var s=t.items[m];if(s.selected){o.context.fillStyle="rgba(255, 187, 40, 0.8)"}else{o.context.fillStyle="rgba(111, 111, 111, 0.8)"}s.x=q;s.y=p+(m*16);s.w=r>0?r:96;s.h=16;o.context.fillRect(s.x,s.y,s.w,s.h);l.h+=s.h;l.w=s.w}}}function d(p,o){if(this.menu.displayMenu){var l=false;var q=this.menu.displayMenu;for(var m=0;m<q.items.length;m++){var n=q.items[m];if(n.text[0]!="-"&&b(n.x,n.y,n.w,n.h,p,o)){if(!n.selected){l=true}n.selected=true}else{if(n.selected){l=true}n.selected=false}}if(l){this.update()}}}function g(o,r,q){if(this.menu.displayMenu){var m=false;var s=this.menu.displayMenu;var l=-1;for(var n=0;n<s.items.length;n++){var p=s.items[n];if(b(p.x,p.y,p.w,p.h,r,q)){p.selected=true;l=n}else{p.selected=false}}if(l>=0){if(s.items[l].text[0]=="-"){return true}this.HideMenu();callback=s.items[l].callback;if(typeof callback!=="undefined"&&this.isFunction(callback)){callback.call(this)}this.update();return true}}return false}function b(l,q,m,p,o,n){return(l<o&&l+m>=o&&q<n&&q+p>=n)}truss_o.extendModule(k,"view.Menu",["view.Input","view.Interface","core.Events","core.runtime"])}());(function(){function a(d){d.DispatchEvents(c)}function c(g,i){console.log("dispatched: "+g,i);switch(g){case"addNode":var f=this.uuid();var h={};var e=-1;if(typeof i!=="undefined"&&i>=0){e=this.AddObject(f,this.objects[i].x+2,this.objects[i].y+45,h);var d=b(this,i,e);if(typeof d!=="undefined"){this.PushEvent("moved",[e,d.x,d.y])}this.PushEvent("connectNode",[i,e])}else{e=this.AddObject(f,this.objects.length*4,200,h)}this.PushEvent("NodeProps",[e,h.label,h.labelRight,f]);this.PushEvent("nodeSelected",e);this.update();break;case"NodeProps":this.setPropsI(i[0],i[1],i[2],i[3]);break;case"moved":this.objects[i[0]].x=i[1];this.objects[i[0]].y=i[2];break;case"iseparateNode":if(typeof i!=="undefined"&&i>=0){if(this.separateIfOneConnection(i)){}else{this.runtime.separateWith=i}}break;case"separateNode":this.separateTwo(i[0],i[1]);break;case"removeNode":if(typeof i!=="undefined"&&i>=0){if(i==this.selectedNode){this.selectedNode=-1}this.RemoveObject(i)}break;case"iconnectNode":if(typeof i!=="undefined"&&i>=0){this.runtime.temporaryConnection=true;this.runtime.connectFrom=i}this.update();break;case"nodeSelected":if(typeof i!=="undefined"&&i>=0){if(this.objects.length<=i){console.log("wrong new index selected");return}this.invokeEvent("nodeFocusLost",[this.selectedNode,i,this.selectedNode>=0?this.objects[this.selectedNode]:null]);this.invokeEvent("nodeSelected",[i,this.objects[i]]);this.selectedNode=i;if(this.runtime.temporaryConnection){this.PushEvent("connectNode",[this.runtime.connectFrom,i]);this.runtime.temporaryConnection=false}if(this.runtime.separateWith>=0){this.PushEvent("separateNode",[this.runtime.separateWith,i]);this.runtime.separateWith=-1}}this.update();break;case"connectNode":this.ConnectIndexes(i[0],i[1]);break}}function b(g,e,m){var f=g.objects[e];var j=g.ConnectedTo(e);var h=g.ConnectedFrom(e);if(h.length>1){var k=0;if(h[0]===m){k=h[1]}else{k=h[0]}var d=g.objects[k];var n=d.x-f.x+21;var l=d.y-f.y+11;return{x:n+f.x,y:l+f.y}}if(j.length===1){var i=g.objects[j[0]];var n=f.x-i.x;var l=f.y-i.y;return{x:n+f.x,y:l+f.y}}}truss_o.extendModule(a,"simpleDispatcher",["view.Input","core.runtime"])}());(function(){function e(g){g.Events={};g.addEvent=d;g.addEventCallback=b;g.clearEventCallbacks=f;g.invokeEvent=c;g.addEventListener=a}function d(g){if(typeof this.Events[g]==="undefined"||this.Events[g]===null){this.Events[g]=new Array()}else{throw"the event "+g+" already registered"}}function b(g,h){if(typeof this.Events[g]==="undefined"||this.Events[g]===null){throw"the event "+g+" not registered"}else{this.Events[g].push(h)}}function f(g){if(typeof this.Events[g]==="undefined"||this.Events[g]===null){throw"the event "+g+" not registered"}else{this.Events[g]=new Array()}}function c(h,g){var k=this.Events[h];if(typeof k==="undefined"||k===null){throw"the event "+h+" not registered"}else{for(var j=0;j<k.length;j++){k[j].apply(this,g)}}}function a(i,g){var h=this;var j=this.canvas;if(i=="mouseup"){j=document}j.addEventListener(i,function(l,k,m){g.apply(h,[l,k,m])},false);this.log("registerd evt listener "+i)}truss_o.extendModule(e,"core.Events")}());(function(){function b(g){g.blurCanvas=function(){e(this.context,0,0,this.bounds.width,this.bounds.height,2,1)}}truss_o.extendModule(b,"extBlur","view.Interface");var a=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1];var f=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];function d(p,n,o,g,k){var l=document.getElementById(p);var q=l.naturalWidth;var m=l.naturalHeight;var j=document.getElementById(n);j.style.width=q+"px";j.style.height=m+"px";j.width=q;j.height=m;var i=j.getContext("2d");i.clearRect(0,0,q,m);i.drawImage(l,0,0);if(isNaN(o)||o<1){return}if(g){c(n,0,0,q,m,o,k)}else{e(n,0,0,q,m,o,k)}}function c(W,C,B,h,k,H,L){if(isNaN(H)||H<1){return}H|=0;if(isNaN(L)){L=1}L|=0;if(L>3){L=3}if(L<1){L=1}var K;try{try{K=W.getImageData(C,B,h,k)}catch(R){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");K=W.getImageData(C,B,h,k)}catch(R){alert("Cannot access local image");throw new Error("unable to access local image data: "+R);return}}}catch(R){alert("Cannot access image");throw new Error("unable to access image data: "+R);return}var o=K.data;var n,E,D,q,G,F,M,J,S,Q,t,v,s,T,z;var j=h-1;var P=k-1;var l=h*k;var w=H+1;var A=a[H];var m=f[H];var I=[];var O=[];var U=[];var V=[];var u=[];var N=[];while(L-->0){s=v=0;for(F=0;F<k;F++){n=o[s]*w;E=o[s+1]*w;D=o[s+2]*w;q=o[s+3]*w;for(M=1;M<=H;M++){J=s+(((M>j?j:M))<<2);n+=o[J++];E+=o[J++];D+=o[J++];q+=o[J]}for(G=0;G<h;G++){I[v]=n;O[v]=E;U[v]=D;V[v]=q;if(F==0){u[G]=((J=G+w)<j?J:j)<<2;N[G]=((J=G-H)>0?J<<2:0)}S=s+u[G];Q=s+N[G];n+=o[S++]-o[Q++];E+=o[S++]-o[Q++];D+=o[S++]-o[Q++];q+=o[S]-o[Q];v++}s+=(h<<2)}for(G=0;G<h;G++){t=G;n=I[t]*w;E=O[t]*w;D=U[t]*w;q=V[t]*w;for(M=1;M<=H;M++){t+=(M>P?0:h);n+=I[t];E+=O[t];D+=U[t];q+=V[t]}v=G<<2;for(F=0;F<k;F++){o[v+3]=z=(q*A)>>>m;if(z>0){z=255/z;o[v]=((n*A)>>>m)*z;o[v+1]=((E*A)>>>m)*z;o[v+2]=((D*A)>>>m)*z}else{o[v]=o[v+1]=o[v+2]=0}if(G==0){u[F]=((J=F+w)<P?J:P)*h;N[F]=((J=F-H)>0?J*h:0)}S=G+u[F];Q=G+N[F];n+=I[S]-I[Q];E+=O[S]-O[Q];D+=U[S]-U[Q];q+=V[S]-V[Q];v+=h<<2}}}W.putImageData(K,C,B)}function e(m,S,Q,I,C,o,M){if(isNaN(o)||o<1){return}o|=0;if(isNaN(M)){M=1}M|=0;if(M>3){M=3}if(M<1){M=1}var P;try{try{P=m.getImageData(S,Q,I,C)}catch(R){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");P=m.getImageData(S,Q,I,C)}catch(R){alert("Cannot access local image");throw new Error("unable to access local image data: "+R);return}}}catch(R){alert("Cannot access image");throw new Error("unable to access image data: "+R);return}var D=P.data;var l,w,J,B,v,u,L,E,k,h,O,U,H,A;var n=I-1;var j=C-1;var s=I*C;var F=o+1;var z=[];var N=[];var T=[];var K=a[o];var G=f[o];var q=[];var t=[];while(M-->0){H=U=0;for(u=0;u<C;u++){l=D[H]*F;w=D[H+1]*F;J=D[H+2]*F;for(L=1;L<=o;L++){E=H+(((L>n?n:L))<<2);l+=D[E++];w+=D[E++];J+=D[E++]}for(v=0;v<I;v++){z[U]=l;N[U]=w;T[U]=J;if(u==0){q[v]=((E=v+F)<n?E:n)<<2;t[v]=((E=v-o)>0?E<<2:0)}k=H+q[v];h=H+t[v];l+=D[k++]-D[h++];w+=D[k++]-D[h++];J+=D[k++]-D[h++];U++}H+=(I<<2)}for(v=0;v<I;v++){O=v;l=z[O]*F;w=N[O]*F;J=T[O]*F;for(L=1;L<=o;L++){O+=(L>j?0:I);l+=z[O];w+=N[O];J+=T[O]}U=v<<2;for(u=0;u<C;u++){D[U]=(l*K)>>>G;D[U+1]=(w*K)>>>G;D[U+2]=(J*K)>>>G;if(v==0){q[u]=((E=u+F)<j?E:j)*I;t[u]=((E=u-o)>0?E*I:0)}k=v+q[u];h=v+t[u];l+=z[k]-z[h];w+=N[k]-N[h];J+=T[k]-T[h];U+=I<<2}}}m.putImageData(P,S,Q)}}());(function(){function b(c){c.fonts={familys:[]};c.loadFont=a}function a(c,g){if(this.fonts.familys.indexOf(c)>=0){return c}var f=document.createElement("style");var e="src: ";for(var d=0;d<g.length;d++){e+=(d>0?",":"")+'url("'+g[d]+'") format("woff")\n'}f.appendChild(document.createTextNode(' 			@font-face {   font-family: "'+c+'";   '+e+";   font-weight: normal;   font-style: normal; } 			"));document.head.appendChild(f);this.fonts.familys.push(c);return c}truss_o.extendModule(b,"view.Fonts",["view.Interface","core.runtime"])}());(function(){var e=Math.PI/180;function b(k){k.runtime.images={objects:[],atlases:[],loaded:[],textures:[]};k.LoadImage=i;k.AddAtlas=c;k.DrawAtlas=h;k.DrawAtlasAngle=j;k.DrawImage=a;k.ImageLoaded=f;k.CreateTexture=g;k.DrawTexture=d}function d(n,l,k,m,o){this.context.drawImage(n,l,k,m,o)}function g(k,n){var l=this.runtime.images;var m=document.createElement("canvas");m.width=k;m.height=n;l.textures.push(m);return m}function f(k){return this.runtime.images.loaded[k]}function i(l,o){var m=new Image();m.src=l;var n=this.runtime.images.objects.length;var k=this;m.onload=function(){k.runtime.images.loaded[n]=true;console.log("image loaded: "+l);if(typeof o!=="undefined"){o.apply(k,[k.runtime.images.objects[n]])}};this.runtime.images.loaded.push(false);this.runtime.images.objects.push(m);return this.runtime.images.objects.length-1}function a(m,l,k,n,o){if(m<0||!this.ImageLoaded(m)){return}this.context.drawImage(this.runtime.images.objects[m],l,k,n,o)}function c(m,p,o,k,n){var l={i:m,sx:p,sy:o,sw:k,sh:n};this.runtime.images.atlases.push(l);return this.runtime.images.atlases.length-1}function h(o,m,l,n,p){if(o<0){return}var k=this.runtime.images.atlases[o];this.context.drawImage(this.runtime.images.objects[k.i],k.sx,k.sy,k.sw,k.sh,m,l,n,p)}function j(o,m,l,n,p,q){if(o<0){return}var k=this.runtime.images.atlases[o];this.context.save();this.context.translate(m,l);this.context.rotate(q*e);this.context.drawImage(this.runtime.images.objects[k.i],k.sx,k.sy,k.sw,k.sh,0,0,n,p);this.context.restore()}truss_o.extendModule(b,"view.Images",["view.Interface","view.Layers","core.Events","core.runtime"])}());(function(){function d(e){e.runtime.inputEventOut="input_ge";e.runtime.inputEventPush="inpute_gp";e.addEvent(e.runtime.inputEventPush);e.addEvent(e.runtime.inputEventOut);e.PushEvent=b;e.DispatchEvents=c;e.canvas.focus();e.canvas.setAttribute("tabindex","0")}function b(f,e){this.invokeEvent(this.runtime.inputEventOut,[f,e])}function c(e){this.addEventCallback(this.runtime.inputEventOut,e)}function a(f){f.preventDefault()}truss_o.extendModule(d,"view.Input",["view.Interface","core.Events","core.runtime"])}());(function(){function a(j){j.vLayers=[];j.vCurrentLayer=undefined;j.CommonContext=undefined;j.CommonCanvas=undefined;j.addLayer=e;j.setLayer=i;j.saveLayer=d;j.drawLayer=b;j.invalidateLayer=g;j.hasLayerData=f;j.drawLayerPart=c}function e(m,k){var l=h(this,m);if(l<0){var n=document.createElement("canvas");n.width=this.bounds.width;n.height=this.bounds.height;var j=n.getContext("2d");if(k){document.body.appendChild(n)}this.vLayers.push({name:m,canvas:n,context:j,data:undefined})}else{throw"the layer "+m+" already exists"}}function i(k){if(this.vCurrentLayer===k){return false}if(typeof k==="undefined"){this.saveLayer();this.context=this.CommonContext;this.canvas=this.CommonCanvas;this.vCurrentLayer=undefined;return}var j=h(this,k);if(j<0){throw"layer "+k+" not found"}else{this.saveLayer();this.vCurrentLayer=k;this.context=this.vLayers[j].context;this.canvas=this.vLayers[j].canvas}}function d(){if(typeof this.vCurrentLayer==="undefined"){this.CommonContext=this.context;this.CommonCanvas=this.canvas;return}var j=h(this,this.vCurrentLayer);this.vLayers[j].data=this.GetCanvasData()}function b(k){var j=h(this,k);if(j<0){throw"layer "+k+" not found"}if(this.vLayers[j].data!=undefined){this.PutCanvasData(this.vLayers[j].data)}}function c(o,j,q,l,k,n,p){var m=h(this,o);if(m<0){throw"layer "+o+" not found"}this.PutCanvasDataPart(this.vLayers[m].data,j,q,l,k,n,p)}function g(k){var j=h(this,k);if(j<0){throw"layer "+k+" not found"}this.vLayers[j].data=undefined}function f(k){var j=h(this,k);if(j<0){throw"layer "+k+" not found"}return !(typeof this.vLayers[j].data==="undefined")}function h(j,k){for(var l=0;l<j.vLayers.length;l++){if(j.vLayers[l].name===k){return l}}return -1}truss_o.extendModule(a,"view.Layers","view.Interface")}());(function(){var a=230;function h(i){var j=i.runtime;j.metaSpheres={gradients:[],tex:i.CreateTexture(i.bounds.width,i.bounds.height)};i.MetaPrepareGradient=c;i.MetaDrawGradient=b;i.MetaPostProcess=e;i.postEffectA=g;i.postEffectA_=d;j.metaSpheres.patIMG=i.LoadImage("img/pattern.png",function(k){j.metaSpheres.patFS=i.context.createPattern(k,"repeat")})}function c(i){var j=this.CreateTexture(i*2,i*2);var k=j.getContext("2d");var m=k.createRadialGradient(i,i,1,i,i,i);var l="hsla("+Math.round(Math.random()*360)+", 80%, 60%";m.addColorStop(0,l+",1)");m.addColorStop(1,l+",0)");k.fillStyle=m;k.beginPath();k.arc(i,i,i,0,Math.PI*2,true);k.closePath();k.fill();this.runtime.metaSpheres.gradients.push(j);return this.runtime.metaSpheres.gradients.length-1}function b(m,i,l,j,k){var m=this.runtime.metaSpheres.gradients[m];this.DrawTexture(m,i-m.width*0.5,l-m.height*0.5,j,k)}function e(){var m=this.context.getImageData(0,0,this.bounds.width,this.bounds.height),k=m.data;for(var j=0,l=k.length;j<l;j+=4){if(k[j+3]<a){(k[j+3]*=0.2222)}}this.context.putImageData(m,0,0)}function g(){if(typeof this.runtime.metaSpheres.patFS==="undefined"){return}this.context.globalCompositeOperation="xor";this.context.fillStyle=this.runtime.metaSpheres.patFS;this.context.fillRect(0,0,this.bounds.width,this.bounds.height);this.context.globalCompositeOperation="source-over";this.context.fillStyle="rgb(255, 255, 255)"}function d(){var i=4;var j=false;var l=false;var k=false;var n=this.context.getImageData(0,0,this.bounds.width,this.bounds.height);var m=f(n,[1/2,1/3,1/4,1/5,1/6,1/6],0,this.runtime.metaSpheres.tex);this.context.putImageData(m,0,0)}function f(C,J,o,N){var j=Math.round(Math.sqrt(J.length));var m=Math.floor(j/2);var n=C.data;var D=C.width;var M=C.height;var u=D;var H=M;var p=(N.getContext("2d")).createImageData(u,H);var O=p.data;var v=o?1:0;for(var q=0;q<H;q++){for(var s=0;s<u;s++){var A=q;var B=s;var E=(q*u+s)*4;var z=0,I=0,K=0,L=0;for(var k=0;k<j;k++){for(var l=0;l<j;l++){var F=A+k-m;var G=B+l-m;if(F>=0&&F<M&&G>=0&&G<D){var t=(F*D+G)*4;var i=J[k*j+l];z+=n[t]*i;I+=n[t+1]*i;K+=n[t+2]*i;L+=n[t+3]*i}}}O[E]=z;O[E+1]=I;O[E+2]=K;O[E+3]=L+v*(255-L)}}return p}truss_o.extendModule(h,"view.Metaspheres",["view.Images","view.Interface","view.Layers","core.Events","core.runtime"])}());truss_o.option("test2","sayno");truss_o.say();truss_o.option("test2","world");truss_o.option("test3","sayno");truss_o.say();(function(){function p(t){t.objects=[];t.connections=[];t.conIndexes=[];t.AddObject=c;t.Connect=i;t.ConnectIndexes=o;t.NodeIndex=e;t.GetRelatedObjectsDeep=l;t.separateTwo=h;t.separateIfOneConnection=r;t.RemoveObject=d;t.ConnectedTo=n;t.ConnectedFrom=k;t.runtime.temporaryConnection=false;t.runtime.connectFrom=-1;t.runtime.separateWith=-1;t.addEvent("NodeAdded");t.addEvent("NodeRemoved");t.addEvent("NodePropsChanged");t.addEvent("NodesSeparated");t.option("view.node.radius",10);t.exportData=b;t.importData=s;t.aabb={x:0,y:0,max_x:0,max_y:0,is_invalidate:false};t.addEvent("NodeDisposition");t.addEventCallback("NodeDisposition",f);t.NodeDisposition=j;t.AABBboundsUpdate=a;t.objs_translate={xoffset:0,yoffset:0};t.setProps=m;t.setPropsI=q}function f(t){this.aabb.x=this.aabb.y=16777215;this.aabb.max_x=this.aabb.max_y=0;this.aabb.is_invalidate=true}function a(w,u,v,t){this.aabb.x=Math.min(w+this.objs_translate.xoffset,this.aabb.x);this.aabb.y=Math.min(v+this.objs_translate.yoffset,this.aabb.y);this.aabb.max_x=Math.max(u+this.objs_translate.xoffset,this.aabb.max_x);this.aabb.max_y=Math.max(t+this.objs_translate.yoffset,this.aabb.max_y)}function j(t){this.aabb.x=Math.min(t.x-this.options.view.node.radius+this.objs_translate.xoffset,this.aabb.x);this.aabb.y=Math.min(t.y-this.options.view.node.radius+this.objs_translate.yoffset,this.aabb.y);this.aabb.max_x=Math.max(t.x+this.options.view.node.radius+this.objs_translate.xoffset,this.aabb.max_x);this.aabb.max_y=Math.max(t.y+this.options.view.node.radius+this.objs_translate.yoffset,this.aabb.max_y)}function c(u,t,w,v){if(typeof v==="undefined"){v={}}v.name=u;v.x=typeof t==="undefined"||(t===null?0:t);v.y=typeof w==="undefined"||(t===null?0:w);this.objects.push(v);this.invokeEvent("NodeAdded",[u,t,w,v]);return this.objects.length-1}function i(w,v){var u=this.NodeIndex(w);var t=this.NodeIndex(v);if(u<0||t<0){throw"the nodes for connection not found"}if(u===t){return false}if(g(this,u,t)){return false}this.connections.push([w,v]);this.conIndexes.push([u,t]);return true}function o(u,t){if(u<0||this.objects.length<=u||t<0||this.objects.length<=t){throw"the nodes indexes out of bounds"}if(u===t||g(this,u,t)){return false}this.connections.push([this.objects[u].name,this.objects[t].name]);this.conIndexes.push([u,t]);return true}function g(w,v,u){for(var t=0;t<w.conIndexes.length;t++){if((w.conIndexes[t][0]===v||w.conIndexes[t][0]===u)&&(w.conIndexes[t][1]===v||w.conIndexes[t][1]===u)){return true}}return false}function e(t){for(var u=0;u<this.objects.length;u++){if(this.objects[u].name===t){return u}}return -1}function l(w){var t=[w];for(var u=0;u<t.length;u++){for(var v=0;v<this.conIndexes.length;v++){if(this.conIndexes[v][0]==t[u]&&t.indexOf(this.conIndexes[v][1])<0){t.push(this.conIndexes[v][1])}}}return t}function b(){var t={version:this.version,clientDate:Date()};t.objects=[];for(var u=0;u<this.objects.length;u++){t.objects.push({name:this.objects[u].name,x:this.objects[u].x,y:this.objects[u].y,label:this.objects[u].label,labelRight:this.objects[u].labelRight})}t.connections=this.conIndexes;return t}function s(t){if(typeof t.objects==="object"&&t.objects.length>=0&&typeof t.connections==="object"&&t.connections.length>=0){this.objects=t.objects;this.conIndexes=t.connections;this.update()}}function m(v,u,t){this.PushEvent("NodeProps",[this.FindNode(v),u,t,undefined])}function q(w,v,u,t){this.objects[w].label=v;this.objects[w].labelRight=u;if(typeof t!=="undefined"){this.objects[w].name=t}this.invokeEvent("NodePropsChanged",[w])}function r(z){var y=this;var v=0;var x=-1;for(var w=0;w<y.conIndexes.length;w++){if(y.conIndexes[w][0]===z||y.conIndexes[w][1]===z){v++;x=w}}if(v==1){var u=y.conIndexes[x][0];var t=y.conIndexes[x][1];this.conIndexes.splice(x,1);this.invokeEvent("NodesSeparated",[u,t]);return true}return false}function h(u,t){var x=this;var w=-1;for(var v=0;v<x.conIndexes.length;v++){if((x.conIndexes[v][0]===u&&x.conIndexes[v][1]===t)||(x.conIndexes[v][1]===u&&x.conIndexes[v][0]===t)){w=v;break}}if(w>=0){this.conIndexes.splice(w,1);this.invokeEvent("NodesSeparated",[u,t]);return true}return false}function d(t){var v=this.objects[t];this.objects.splice(t,1);for(var u=0;u<this.conIndexes.length;u++){if(this.conIndexes[u][0]===t||this.conIndexes[u][1]===t){this.conIndexes.splice(u,1);this.connections.splice(u,1);u--}}for(var u=0;u<this.conIndexes.length;u++){if(this.conIndexes[u][0]>t){this.conIndexes[u][0]--}if(this.conIndexes[u][1]>t){this.conIndexes[u][1]--}}this.invokeEvent("NodeRemoved",[v,t])}function n(u){var t=[];for(var v=0;v<this.conIndexes.length;v++){if(this.conIndexes[v][1]===u){t.push(this.conIndexes[v][0])}}return t}function k(t){var v=[];for(var u=0;u<this.conIndexes.length;u++){if(this.conIndexes[u][0]===t){v.push(this.conIndexes[u][1])}}return v}truss_o.extendModule(p,"objects.Tree",["core.Events","core.runtime"])}());(function(){function n(o){o.proxyPanel={activepanel:{x:0,y:0,w:0,h:0,visible:false,bindings:[],addTextBox:j,addButton:l,getControl:b,Show:i,Hide:c},};o.RenderProxyPanels=k;o.showProxyPanel=f;o.ProxyPanelInteractionEntry=m;o.CreateTimer(1000/60,h)}function h(){if(this.proxyPanel.activepanel.visible){var o=2*1/(60/(60/(this.fps.rate>60?60:this.fps.rate)));this.TextBox.activeBox.caretOnDisplay+=this.TextBox.activeBox.caretOnDisplayAlphaIncStep*o;if(this.TextBox.activeBox.caretOnDisplay<0||this.TextBox.activeBox.caretOnDisplay>=1){if(this.TextBox.activeBox.caretOnDisplay<0){this.TextBox.activeBox.caretOnDisplayAlphaIncStep=1}else{this.TextBox.activeBox.caretOnDisplayAlphaIncStep=-1}}this.update()}}function m(r,v,q,s,y){if(this.proxyPanel.activepanel.visible){var o=this.proxyPanel.activepanel;if(q!==null){var t=q;var x=this.runtime.mx;var w=this.runtime.my;if(a(o.x,o.y,o.w,o.h,x,w)){for(var p=0;p<o.bindings.length;p++){var u=o.bindings[p].proxy;u.focus=a(u.x,u.y,u.w,u.h,x,w)}}}else{if(r!==null){if(r.keyCode===9){for(var p=0;p<o.bindings.length;p++){var u=o.bindings[p].proxy;if(u.focus){u.focus=false;if(p+1<o.bindings.length){o.bindings[p+1].proxy.focus=true}else{if(p!==0){o.bindings[0].proxy.focus=true}else{u.focus=true}}break}}return}}}for(var p=0;p<o.bindings.length;p++){var u=o.bindings[p].proxy;if(typeof u.interaction!=="undefined"&&this.isFunction(u.interaction)){u.interaction(this,r,v,q,s,y)}}}}function i(o){this.visible=true;o.update()}function c(o){this.visible=false;for(var q=0;q<this.bindings.length;q++){var p=this.bindings[q].proxy;p.focus=p.hover=false}o.update()}function b(o,p,r){for(var q=0;q<this.bindings.length;q++){if(this.bindings[q].refName===p){return this.bindings[q].proxy}}return null}function j(s,p,u,v,o,q,r){var t=s.AddTextBox(u,v,o,q);var w={refName:p,relative:r,proxy:t};this.bindings.push(w);e(s,this);return w}function l(s,o,v,t,p,u,r){var q=s.addButton(o,v,p,u,t);var w={refName:o,relative:r,proxy:q};this.bindings.push(w);e(s,this);return w}function f(o,r,p,q){o=this.bounds.width-p-4;this.proxyPanel.activepanel.x=o;this.proxyPanel.activepanel.y=r;this.proxyPanel.activepanel.w=p;this.proxyPanel.activepanel.h=q;e(this,this.proxyPanel.activepanel);return this.proxyPanel.activepanel}function e(o,p){for(var r=0;r<p.bindings.length;r++){var q=p.bindings[r].proxy;var s=p.bindings[r].relative;q.x=d(p,s.x,s.xrule);q.y=d(p,s.y,s.yrule);q.w=(s.rrule==="abs"?s.right:d(p,s.right,s.rrule)-q.x);q.h=(s.brule==="abs"?s.bottom:d(p,s.bottom,s.brule)-q.y)}}function d(o,q,p){switch(p){case"left":return o.x+q;break;case"top":return o.y+q;break;case"right":return o.x+o.w+q;break;case"bottom":return o.y+o.h+q;break;case"absx":return proxy.x+q;break;default:throw"unexpected relative rule for child control: "+p;break}}function k(){var o=this.proxyPanel.activepanel;if(o.visible){this.context.fillStyle="rgba(37, 51, 62, .8)";this.context.fillRect(o.x,o.y,o.w,o.h);for(var q=0;q<o.bindings.length;q++){var p=o.bindings[q].proxy;if(typeof p.render!=="undefined"&&this.isFunction(p.render)){p.render(this)}}}}function g(s,o,u,r,q,p){var t=this.proxyPanel.activepanel;t.bindings.push({refName:s,positionAndSize:o,relativePos:u,visible:r,interaction:q,focus:p})}function a(o,t,p,s,r,q){return(o<r&&o+p>=r&&t<q&&t+s>=q)}truss_o.extendModule(n,"view.ProxyPanel",["view.Interface","core.runtime","view.Button","view.TextBox"])}());(function(){function a(b){b.runtime={}}truss_o.extendModule(a,"core.runtime")}());(function(){function m(u){u.mouseDragContext={startX:0,startY:0};u.selectedNode=-1;u.editTextNode=-1;u.Dragging=false;u.FieldDragging=false;u.FieldDraggingPos={startX:0,startY:0,prevX:0,prevY:0};u.moveNodeTo=q;u.DragList=[];u.AddDisplayMenu("node",{items:[{text:"Add + connect",callback:g},{text:"---------------"},{text:"Separate",callback:l},{text:"Connect with...",callback:f},{text:"Remove",callback:s},]});u.AddDisplayMenu("field",{items:[{text:"Find node",callback:undefined},{text:"---------------"},{text:"Locate to map center",callback:undefined},{text:"play intro video",callback:undefined},{text:"play all history",callback:undefined},]});var v=u.showProxyPanel(25,60,164,212);u.loadFont("Ionicons",["/content/fonts/ionicons.woff?v=1.3.5","fonts/ionicons.woff?v=1.3.5"]);v.addButton(u,"test","\uf12e",null,"12px Ionicons",12,{x:-14,y:2,right:0,bottom:14,xrule:"left",yrule:"top",rrule:"left",brule:"abs"});v.addButton(u,"test2","\uf25b",null,"12px Ionicons",12,{x:-14,y:2+14+2,right:0,bottom:14,xrule:"left",yrule:"top",rrule:"left",brule:"abs"});v.addTextBox(u,"label","left caption","text",false,i,{x:8,y:22,right:-2,bottom:14,xrule:"left",yrule:"top",rrule:"right",brule:"abs"});v.addTextBox(u,"label2","right text","text2",true,i,{x:8,y:22+16+22,right:-2,bottom:120,xrule:"left",yrule:"top",rrule:"right",brule:"abs"});var w=v.addButton(u,"bok","\uf120",null,"18px Ionicons",20,{x:8,y:22+16+22+120+4,right:24,bottom:24,xrule:"left",yrule:"top",rrule:"abs",brule:"abs"});var x=v.addButton(u,"bc","\uf128",null,"18px Ionicons",20,{x:8+24+4,y:22+16+22+120+4,right:24,bottom:24,xrule:"left",yrule:"top",rrule:"abs",brule:"abs"});w.proxy.hovercolor="rgb(40, 255, 187)";x.proxy.hovercolor="rgb(255, 40, 187)";w.proxy.drawbackground=false;x.proxy.drawbackground=false;u.EditPanel=v;u.DeltasMeasuring=[];u.addEventListener("mousedown",o);u.addEventListener("mouseup",p);u.addEventListener("mousemove",t);u.addEventListener("dblclick",j);u.addEventListener("click",n);u.addEventListener("keypress",k);u.addEventListener("keydown",d);u.addEvent("MouseDragDelta");u.addEvent("nodeSelected");u.addEvent("nodeFocusLost");u.addEventCallback("Render",r);u.addDeltaMeasuring=h;u.CreateTimer(30,b);u.canvas.oncontextmenu=function(y){if(y.which===3){return false}if(typeof u.getActiveMenuName()==="undefined"){if(u.selectedNode>=0){u.ShowMenu("node",u.objects[u.selectedNode].x,u.objects[u.selectedNode].y)}else{u.ShowMenu("field",0,0)}}return false}}function l(){this.PushEvent("iseparateNode",this.selectedNode)}function g(){this.PushEvent("addNode",this.selectedNode)}function s(){this.PushEvent("removeNode",this.selectedNode)}function f(){this.PushEvent("iconnectNode",this.selectedNode)}function b(){for(var v=0;v<this.DeltasMeasuring.length;v++){var u=this.DeltasMeasuring[v];if(u[0]>=u[1]){u[2].call(this);u[0]=0}}}function h(u,v){this.DeltasMeasuring.push([0,u,v]);return this.DeltasMeasuring.length-1}function c(){}function n(u){}function e(v){v.editTextNode=v.selectedNode;var u=v.objects[v.editTextNode].label;var w=v.objects[v.editTextNode].labelRight;v.EditPanel.getControl(v,"label").setText(u||"");v.EditPanel.getControl(v,"label").focus=true;v.EditPanel.getControl(v,"label2").setText(w||"");v.EditPanel.getControl(v,"bok").callback=function(){i.call(v,"OK")};v.EditPanel.getControl(v,"bc").callback=function(){i.call(v,"Cancel")};v.EditPanel.Show(v);v.PushEvent("nodeEditStart",v.editTextNode)}function k(u){if(this.editTextNode===-1&&u.keyCode===13&&this.selectedNode>=0){e(this)}else{this.ProxyPanelInteractionEntry(u,null,null,null,null)}u.preventDefault()}function d(u){if(this.editTextNode===-1&&u.keyCode===13&&this.selectedNode>=0){e(this);u.preventDefault()}else{if(u.keyCode===13||u.keyCode===8||u.keyCode===37||u.keyCode===39||u.keyCode===40||u.keyCode===38||u.keyCode===46||u.keyCode===27){this.ProxyPanelInteractionEntry(u,null,null,null,null);u.preventDefault()}}}function j(w){if(this.editTextNode>=0){return}this.updateBounds();var x=w.pageX-this.bounds.left;var v=w.pageY-this.bounds.top;for(var u=0;u<this.objects.length;u++){if(a(this.objects[u].x+this.objs_translate.xoffset,this.objects[u].y+this.objs_translate.yoffset,this.options.view.node.radius,x,v)){this.editTextNode=this.nodeSelected=u;break}}if(this.editTextNode>=0){e(this)}}function i(u){if(u==="OK"){this.objects[this.editTextNode].label=this.EditPanel.getControl(this,"label").getText();this.objects[this.editTextNode].labelRight=this.EditPanel.getControl(this,"label2").getText();this.PushEvent("nodeEditAccept",[this.editTextNode,this.objects[this.editTextNode].label,this.objects[this.editTextNode].labelRight]);this.EditPanel.Hide(this);this.editTextNode=-1}else{this.PushEvent("nodeEditDecline",this.editTextNode);this.EditPanel.Hide(this);this.editTextNode=-1}}function o(w){if(this.Dragging){return}if(w.which==1||w.which==3){this.updateBounds();var A=-1;var z=w.pageX-this.bounds.left;var v=w.pageY-this.bounds.top;this.runtime.mx=z;this.runtime.my=v;this.ProxyPanelInteractionEntry(null,null,w,null,null);if(this.menu.displayMenu){if(this.processInteractionMMdown(w.which,z,v)){return}}var y=false;if(this.editTextNode===-1){for(var u=0;u<this.objects.length;u++){if(a(this.objects[u].x+this.objs_translate.xoffset,this.objects[u].y+this.objs_translate.yoffset,this.options.view.node.radius,z,v)){if(this.selectedNode===u){y=true;continue}y=false;this.PushEvent("nodeSelected",u);A=u;break}}}if(A<0&&!y&&this.editTextNode===-1){this.invokeEvent("nodeFocusLost",[this.selectedNode,-1,this.objects[this.selectedNode]]);this.selectedNode=-1}if(w.which==1){this.HideMenu();if(this.selectedNode>=0&&this.editTextNode===-1){this.Dragging=true;this.DragList=this.GetRelatedObjectsDeep(this.selectedNode);for(var u=0;u<this.DragList.length;u++){var x=this.objects[this.DragList[u]];x.targetX=0;x.targetY=0;x.dragOn=false}this.mouseDragContext.startX=z-this.objects[this.selectedNode].x-this.objs_translate.xoffset;this.mouseDragContext.startY=v-this.objects[this.selectedNode].y-this.objs_translate.yoffset;this.objects[this.selectedNode].dragOn=false;this.objects[this.selectedNode].targetX=0;this.objects[this.selectedNode].targetY=0;this.objects[this.selectedNode].prevx=this.objects[this.selectedNode].x;this.objects[this.selectedNode].prevy=this.objects[this.selectedNode].y}this.FieldDragging=(A==-1)&&this.editTextNode===-1;if(this.FieldDragging){this.FieldDraggingPos.startX=z;this.FieldDraggingPos.startY=v;this.FieldDraggingPos.prevX=this.objs_translate.xoffset;this.FieldDraggingPos.prevY=this.objs_translate.yoffset}}else{if(this.editTextNode===-1){if(this.selectedNode>=0||this.objects.length===0){this.ShowMenu("node",z,v)}else{console.log("mdown",this.getActiveMenuName());if(this.getActiveMenuName()!==undefined){this.HideMenu()}else{this.ShowMenu("field",z,v)}}}}}this.canvas.focus();w.preventDefault()}function p(v){var w=v.pageX-this.bounds.left;var u=v.pageY-this.bounds.top;this.runtime.mx=w;this.runtime.my=u;if(v.which==1){if(this.FieldDragging){this.FieldDragging=false}if(this.Dragging){this.Dragging=false;if(this.selectedNode>=0&&(this.objects[this.selectedNode].x!=this.objects[this.selectedNode].prevx||this.objects[this.selectedNode].y!=this.objects[this.selectedNode].prevy)){this.PushEvent("moved",[this.selectedNode,this.objects[this.selectedNode].x,this.objects[this.selectedNode].y])}}}this.ProxyPanelInteractionEntry(null,null,null,v,null);v.preventDefault()}function t(z){this.acceptSetCursor(true);this.setCursor("default");var A=z.pageX-this.bounds.left;var y=z.pageY-this.bounds.top;this.runtime.mx=A;this.runtime.my=y;if(this.Dragging){this.moveNodeTo(this.selectedNode,A-this.objs_translate.xoffset-this.mouseDragContext.startX,y-this.objs_translate.yoffset-this.mouseDragContext.startY);this.update()}else{if(this.FieldDragging){var v=A-this.FieldDraggingPos.startX;var u=y-this.FieldDraggingPos.startY;this.objs_translate.xoffset=v+this.FieldDraggingPos.prevX;this.objs_translate.yoffset=u+this.FieldDraggingPos.prevY;var x=Math.sqrt(Math.pow(v,2)+Math.pow(u,2));for(var w=0;w<this.DeltasMeasuring.length;w++){this.DeltasMeasuring[w][0]+=x}this.update()}else{if(this.runtime.temporaryConnection){this.update()}}}this.processInteractionMMove(A,y);this.ProxyPanelInteractionEntry(null,null,null,null,z);this.acceptSetCursor(false);z.preventDefault()}function a(v,C,u,B,A){var z=v-B;var w=C-A;return(z*z+w*w<u*u*4)}function q(w,v,u){this.objects[w].targetX=v;this.objects[w].targetY=u;this.objects[w].dragOn=true}function r(){var A=0;var y=0;if(this.selectedNode>=0){this.objects[this.selectedNode].needDrag=(Math.abs(this.objects[this.selectedNode].x-this.objects[this.selectedNode].targetX)>0.1)||(Math.abs(this.objects[this.selectedNode].y-this.objects[this.selectedNode].targetY)>0.1);if(this.objects[this.selectedNode].needDrag&&this.objects[this.selectedNode].dragOn){var v=0.4*(this.objects[this.selectedNode].targetX-this.objects[this.selectedNode].x);var u=0.4*(this.objects[this.selectedNode].targetY-this.objects[this.selectedNode].y);this.objects[this.selectedNode].x=this.objects[this.selectedNode].x+v;this.objects[this.selectedNode].y=this.objects[this.selectedNode].y+u;for(var x=1;x<this.DragList.length;x++){var w=this.DragList[x];this.objects[w].x+=v;this.objects[w].y+=u}A=Math.max(A,Math.abs(v));y=Math.max(y,Math.abs(u))}}if(A>0||y>0){var z=Math.sqrt(Math.pow(A,2)+Math.pow(y,2));for(var x=0;x<this.DeltasMeasuring.length;x++){this.DeltasMeasuring[x][0]+=z}}}truss_o.extendModule(m,"view.Structure",["view.Input","core.Events","core.Animate","objects.Tree","view.Interface","view.Menu","view.ProxyPanel"])}());(function(){function j(r){r.TextBox={x:0,y:0,width:128,height:14,isOnDisplay:false,activeBox:{multiline:false,label:"nolabel",caretOnDisplay:1,caretOnDisplayAlphaIncStep:3*1/30,caretSETupDownX:0,caretPositionX:0,state:{isDragging:false,selection:{left:0,right:0}},measured:false,caretLine:0,caretIndex:0,text:"first line",lines:[{t:"first line",w:0,davw:0,y:0},{t:"second line",w:0,davw:0,y:0},{t:"x",w:0,davw:0,y:0},{t:"xu",w:0,davw:0,y:0}],fadeIn:1,fadeOut:false},textboxes:[]};r.AddTextBox=i;r.TextBoxInteractionInput=o;r.TextBoxGetSelectedText=l}function m(r){r.SetShadow();if(!this.measured){e(r,this,true)}n(r,this);e(r,this,false)}function i(s,v,t,u){var r={x:0,y:0,w:0,h:0,visible:1,interaction:o,focus:false,fonth:13,scrollx:0,scrolly:0,scrollchunkyh:0,scrollchunkxw:0,scrollchunkyy:0,scrollchunkxx:0,textwidth:0,textheight:0,render:m,setText:g,getText:p,acceptedOrDeclined:u,caretSETupDownX:0,caretPositionX:0,caretPositionY:0,state:{isDragging:false,selection:{left:0,right:0}},measured:false,caretLine:0,caretIndex:-1,label:s,multiline:t,text:"first line",lines:[{t:v,w:0,davw:0,y:0}]};this.TextBox.textboxes.push(r);return r}function k(){var r="";for(var s=0;s<this.TextBox.activeBox.lines.length;s++){r+=this.TextBox.activeBox.lines[s].t}return r}function g(t){var s=t.split("\n");this.lines.length=s.length;for(var r=0;r<s.length;r++){this.lines[r]={t:s[r],w:0,davw:0,y:0}}this.measured=false;this.scrollx=this.scrolly=this.caretLine=this.caretPositionX=0;this.caretIndex=-1;this.text=t}function p(){var r="";for(var s=0;s<this.lines.length;s++){r+=this.lines[s].t+(s+1<this.lines.length?"\n":"")}return r}var c=[95,93,125,123,91,160,171,92,8230,187];function o(C,F,y,M,J,u){if(u!==null){var L=u;var D=C.runtime.mx;var B=C.runtime.my;var I=false;for(var H=0;H<this.lines.length;H++){if(b(this.x-4,this.lines[H].y,this.w,this.h,D,B)){I=true;break}if(!this.multiline){break}}if(I){C.setCursor("text")}}else{if(this.focus){if(J!==null&&J.which===1){var L=J;var D=C.runtime.mx+this.scrollx;var B=C.runtime.my+this.scrolly;d(C);for(var H=0;H<this.lines.length;H++){if(b(this.x-4,this.lines[H].y,this.w,12,D,B)){f(C,this,H,D-this.x);this.caretSETupDownX=this.caretPositionX}if(!this.multiline){break}}}else{if(F!==null){var L=F;if(L.keyCode===8){var E=this.lines[this.caretLine].t;if(this.caretIndex==-1){if(this.caretLine>0&&this.multiline){var z=this.lines[this.caretLine-1].t.length-1;this.lines[this.caretLine-1].t=this.lines[this.caretLine-1].t+E;this.caretLine--;this.caretPositionY=this.lines[this.caretLine].y;this.caretSETupDownX=this.caretPositionX=this.lines[this.caretLine].w;this.caretIndex=z;this.lines.splice(this.caretLine+1,1);q(C,this);this.measured=false}}else{var A=E.substr(0,this.caretIndex);d(C);var G=C.context.measureText(A);this.lines[this.caretLine].t=A+E.substr(this.caretIndex+1,E.length-this.caretIndex-1);this.caretIndex--;this.caretSETupDownX=this.caretPositionX=G.width;this.measured=false;q(C,this)}}else{if(L.keyCode===37){if(L.ctrlKey){var x=false;var K=this.caretIndex;while(K>=0){var t=this.lines[this.caretLine].t.charCodeAt(K);if(c.indexOf(t)>=0||(t<=64&&t>=0)){if(x){this.caretIndex=K;break}}else{if(!x){x=true}}K--}if(K===-1&&x){this.caretIndex=-1}}else{this.caretIndex--}if(this.caretIndex<-1){this.caretIndex=-1}d(C);var G=C.context.measureText(this.lines[this.caretLine].t.substr(0,this.caretIndex+1));this.caretSETupDownX=this.caretPositionX=G.width;q(C,this)}else{if(L.keyCode===39){if(L.ctrlKey){var x=false;var s=false;var K=this.caretIndex;var v=this.lines[this.caretLine].t.length;while(K<v){var t=this.lines[this.caretLine].t.charCodeAt(K);if(c.indexOf(t)>=0||(t<=64&&t>=0)){if(x){s=true}}else{if(!x){x=true}else{if(s){this.caretIndex=K-1;break}}}K++}if(K===v&&x){this.caretIndex=v-1}}else{this.caretIndex++}if(this.caretIndex>this.lines[this.caretLine].t.length){this.caretIndex=this.lines[this.caretLine].t.length-1}d(C);var G=C.context.measureText(this.lines[this.caretLine].t.substr(0,this.caretIndex+1));this.caretSETupDownX=this.caretPositionX=G.width;q(C,this)}else{if(L.keyCode===40){if(this.multiline){this.caretLine++;if(this.caretLine>=this.lines.length){this.caretLine=this.lines.length-1}f(C,this,this.caretLine,this.caretSETupDownX);q(C,this)}}else{if(L.keyCode===38){if(this.multiline){this.caretLine--;if(this.caretLine<0){this.caretLine=0}f(C,this,this.caretLine,this.caretSETupDownX);q(C,this)}}else{if(L.keyCode===46){var E=this.lines[this.caretLine].t;if(E.length>=this.caretIndex+2){var A=E.substr(0,this.caretIndex+1);this.lines[this.caretLine].t=A+E.substr(this.caretIndex+2,E.length-this.caretIndex-1);this.measured=false}}else{if(L.keyCode==27){if(typeof this.acceptedOrDeclined!=="undefined"&&C.isFunction(this.acceptedOrDeclined)){this.acceptedOrDeclined.call(C,"ESCAPE")}}else{if(L.keyCode===13){if(this.multiline){var E=this.lines[this.caretLine].t;this.caretLine++;if(this.caretLine>this.lines.length){throw""}var r=(this.caretLine===0?this.fonth:this.lines[this.caretLine-1].y+this.fonth);if(this.caretLine===this.lines.length){this.lines.push({t:"xu",w:0,davw:0,y:r})}else{this.lines.splice(this.caretLine,0,{t:"xu",w:0,davw:0,y:r})}this.lines[this.caretLine-1].t=E.substr(0,this.caretIndex+1);this.lines[this.caretLine].t=E.substr(this.caretIndex+1,E.length-this.caretIndex-1);this.caretIndex=-1;this.caretPositionY=this.lines[this.caretLine-1].y+this.fonth;this.caretSETupDownX=this.caretPositionX=0;this.measured=false;this.textheight=r-this.y;q(C,this)}else{if(typeof this.acceptedOrDeclined!=="undefined"&&C.isFunction(this.acceptedOrDeclined)){this.acceptedOrDeclined.call(C,"OK")}}}else{var O=L.keyCode||L.which;var N=String.fromCharCode(O);var E=this.lines[this.caretLine].t;d(C);var G=null;if(this.caretIndex>=0){var w=E.substr(0,this.caretIndex+1);this.lines[this.caretLine].t=w+N+E.substr(this.caretIndex+1,E.length-this.caretIndex-1);G=C.context.measureText(w+N)}else{this.lines[this.caretLine].t=N+E;G=C.context.measureText(N)}this.caretSETupDownX=this.caretPositionX=G.width;this.measured=false;this.caretIndex++;q(C,this)}}}}}}}}}}}}}function f(t,w,z,y){var v=-1;if(w.lines[z].t.length>0){v=Math.floor((y)/w.lines[z].davw)-1;if(v<-1){v=-1}d(t);var A=w.lines[z].t.length;var s=t.context.measureText(w.lines[z].t.substr(0,v+1));if(v>=A){v=A-1}else{while((s.width<y)&&v>=0&&v<A){v++;s=t.context.measureText(w.lines[z].t.substr(0,v+1))}var r=s.width-y;var u=t.context.measureText(w.lines[z].t.substr(0,v));if(r>3){v--;s=u}if(v>=A){v=A-1;s=t.context.measureText(w.lines[z].t.substr(0,v+1))}}w.caretPositionX=s.width}else{w.caretPositionX=0}w.caretPositionY=0;w.caretIndex=v;w.caretLine=z}function q(r,s){var t=s.lines[s.caretLine].y-s.y;var u=s.caretPositionX;if(u-s.scrollx>=s.w){s.scrollx=u-s.w+44;s.measured=false}else{if(u-s.scrollx<=0){s.scrollx=u-44;if(s.scrollx<0){s.scrollx=0}s.measured=false}}if(t-s.scrolly+s.fonth>=s.h){s.scrolly=t-s.h+44;s.measured=false}else{if(t-s.scrolly<=0){s.scrolly=t-44;if(s.scrolly<0){s.scrolly=0}s.measured=false}}}function n(r,s){var u=r.TextBox.activeBox;r.SetShadow(0,0,4,"rgba(255, 255, 255, "+Math.min(0.5,u.fadeIn)+")");if(s.focus){r.context.fillStyle="rgba(236, 244, 252, "+Math.min(0.9,u.fadeIn)+")"}else{r.context.fillStyle="rgba(136, 136, 136, "+Math.min(0.7,u.fadeIn)+")"}r.context.fillRect(s.x-4,s.y-4,s.w+4,s.h+4);r.SetShadow();r.context.fillStyle="rgba(111, 111, 111, "+Math.min(0.4,u.fadeIn)+")";r.context.fillRect(s.x-4,s.y-(4+12+2),s.w+4,12+2);d(r);r.context.font="10px Verdana";r.context.fillStyle="rgba(255, 255, 255, "+u.fadeIn+")";r.context.fillText(s.label+":",s.x,s.y-4-2);r.context.fillStyle="rgba(255, 0, 0, "+Math.min(0.7,u.fadeIn)+")";if(s.multiline){if(s.scrollchunkyh<s.h||s.scrolly>0){var t=s.h-4;r.context.fillRect(s.x+s.w-3,s.y+s.scrollchunkyy,2,s.scrollchunkyh)}}if(s.scrollchunkxw<s.w||s.scrollx>0){r.context.fillRect(s.x+s.scrollchunkxx,s.y+s.h-(s.multiline?3:2),s.scrollchunkxw,s.multiline?2:1)}}function d(r){r.SetShadow();r.context.font="13px Verdana";r.context.textBaseline="bottom";r.context.textAlign="start";r.context.fillStyle="rgba(0, 0, 0, "+r.TextBox.activeBox.fadeIn+")"}function e(u,v,t){d(u);var x=0,w=0;if(t){}else{u.context.save();u.context.beginPath();u.context.rect(v.x,v.y-4,v.w,v.h+4);u.context.clip();u.context.translate(-v.scrollx,-v.scrolly)}for(var r=0;r<v.lines.length;r++){if(t){var s=u.context.measureText(v.lines[r].t);v.lines[r].w=s.width;x=Math.max(x,s.width);v.lines[r].davw=s.width/v.lines[r].t.length;v.lines[r].y=v.y+(r*v.fonth);w=v.lines[r].y-v.y}else{u.context.fillText(v.lines[r].t,v.x,v.lines[r].y+v.fonth)}if(!v.multiline){break}}if(t){v.textwidth=x;v.textheight=w;var z=v.h+v.scrolly-w;z=z>0?z:0;v.scrollchunkyh=(v.h/(w+z))*v.h;v.scrollchunkyy=(v.h/(w+z))*v.scrolly;var y=v.w+v.scrollx-x;y=y>0?y:0;v.scrollchunkxw=(v.w/(x+y))*v.w;v.scrollchunkxx=(v.w/(x+y))*v.scrollx;v.measured=true;return}else{if(v.focus){u.context.strokeStyle="rgba(0, 0, 0, "+Math.min(u.TextBox.activeBox.caretOnDisplay,u.TextBox.activeBox.fadeIn)+")";u.context.beginPath();u.context.lineWidth=1;u.context.moveTo(v.caretPositionX+v.x+0.5,v.lines[v.caretLine].y+-2+1);u.context.lineTo(v.caretPositionX+v.x+0.5,v.lines[v.caretLine].y+2+10);u.context.closePath();u.context.stroke()}u.context.restore()}}function h(){this.TextBox.isOnDisplay=false;this.TextBox.activeBox.fadeOut=true;this.update()}function a(s,r){}function l(){}function b(r,z,s,v,u,t){return(r<u&&r+s>=u&&z<t&&z+v>=t)}truss_o.extendModule(j,"view.TextBox",["view.Interface","core.Animate"])}());(function(){function q(v){p(v);v.updateBounds=function(){p(v)};v.ViewEngines=[];v.ActiveEngine=null;v.addViewEngine=l;v.setViewEngine=m;v.FindViewEngine=k;v.Clear=t;v.ClearRect=d;v.GetCanvasData=a;v.PutCanvasData=i;v.PutCanvasDataPart=n;v.SetShadow=e;v.drawArrow=f;v.cursorStyle="reset";v.lastCursorSet="default";v.setCursor=u;v.acceptSetCursor=g;v.addEventCallback("NodeAdded",s);v.addEventCallback("NodesSeparated",o);v.addEventCallback("NodeRemoved",b);v.addEventCallback("Render",r);v.addEventCallback("update",j)}function u(v){if(this.cursorStyle!==v){this.cursorStyle=v}}function g(v){if(v){this.cursorStyle="reset"}else{if(this.cursorStyle!=="reset"&&this.lastCursorSet!=this.cursorStyle){this.canvas.style.cursor=this.lastCursorSet=this.cursorStyle}}}function p(v){v.bounds={width:v.canvas.width,height:v.canvas.height,left:v.canvas.offsetLeft,top:v.canvas.offsetTop}}function l(v,x){var w=this.FindViewEngine(v);if(w<0){this.ViewEngines.push({name:v,iface:x})}else{throw"the view engine "+v+" already registered"}}function m(v){var w=this.FindViewEngine(v);if(w<0){throw"the view interface "+v+" not found"}this.ActiveEngine=this.ViewEngines[w]}function k(v){for(var w=0;w<this.ViewEngines.length;w++){if(this.ViewEngines[w].name===v){return w}}return -1}function t(){this.context.clearRect(0,0,this.bounds.width,this.bounds.height)}function d(v){this.context.clearRect(v.x,v.y,v.width,v.height)}function a(){var v=this.canvas;return v}function i(v){this.context.drawImage(v,0,0)}function n(D,v,C,z,w,A,B){this.context.drawImage(D,v,C,z,w,A,B)}function s(w,v){this.update()}function o(w,v){this.update()}function b(w,v){this.update()}function c(v,w){if(v.ActiveEngine!==null){v.ActiveEngine.iface[w].call(v)}}function e(v,y,x,w){if(typeof v==="undefined"){this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowBlur=0}else{this.context.shadowOffsetX=v;this.context.shadowOffsetY=y;this.context.shadowBlur=x;this.context.shadowColor=w}}function j(){c(this,"update")}function r(){c(this,"Render")}function f(K,y,I,x,J,E,L,N){J=typeof(J)!="undefined"?J:3;E=typeof(E)!="undefined"?E:1;L=typeof(L)!="undefined"?L:Math.PI/8;N=typeof(N)!="undefined"?N:10;var G=typeof(J)!="function"?h:J;var F=Math.sqrt((I-K)*(I-K)+(x-y)*(x-y));var B=(F-N/3)/F;var D,C,O,M;if(E&1){D=K+(I-K)*B;C=y+(x-y)*B}else{D=I;C=x}if(E&2){O=K+(I-K)*(1-B);M=y+(x-y)*(1-B)}else{O=K;M=y}this.context.beginPath();this.context.moveTo(O,M);this.context.lineTo(D,C);this.context.stroke();var R=Math.atan2(x-y,I-K);var H=Math.abs(N/Math.cos(L));if(E&1){var w=R+Math.PI+L;var A=I+Math.cos(w)*H;var z=x+Math.sin(w)*H;var v=R+Math.PI-L;var Q=I+Math.cos(v)*H;var P=x+Math.sin(v)*H;G(this.context,A,z,I,x,Q,P,J)}if(E&2){var w=R+L;var A=K+Math.cos(w)*H;var z=y+Math.sin(w)*H;var v=R-L;var Q=K+Math.cos(v)*H;var P=y+Math.sin(v)*H;G(this.context,A,z,K,y,Q,P,J)}}function h(H,P,z,N,x,K,v,L){H.beginPath();H.moveTo(P,z);H.lineTo(N,x);H.lineTo(K,v);H.stroke();switch(L){case 0:var R=Math.sqrt(((K-P)*(K-P))+((v-z)*(v-z)));H.arcTo(N,x,P,z,0.55*R);H.fill();break;case 1:H.lineTo(P,z);H.fill();break;case 2:H.stroke();break;case 3:var C=(P+N+K)/3;var A=(z+x+v)/3;H.quadraticCurveTo(C,A,P,z);H.fill();break;case 4:var O,M,y,w,R;var F=5;if(K==P){R=v-z;O=(N+P)/2;y=(N+P)/2;M=x+R/F;w=x-R/F}else{R=Math.sqrt(((K-P)*(K-P))+((v-z)*(v-z)));var I=(P+K)/2;var B=(z+v)/2;var J=(I+N)/2;var Q=(B+x)/2;var G=(v-z)/(K-P);var E=(R/(2*Math.sqrt(G*G+1)))/F;var D=G*E;O=J-E;M=Q-D;y=J+E;w=Q+D}H.bezierCurveTo(O,M,y,w,P,z);H.fill();break}}truss_o.extendModule(q,"view.Interface",["core.Events","core.Animate"])}());(function(){var d="dbg.background";var j="dbg.nodes";var e="dbg.text";var c="dbg.menu";var i=[];function f(o){var p={Render:g,update:h};o.option("view.dbg.backgroundColor1","rgba(60, 78, 98, 1)");o.option("view.dbg.backgroundColor2","rgba(35, 47, 59, 1)");o.addViewEngine("Debug",p);o.setViewEngine("Debug");o.addLayer(d);o.addLayer(j);o.addLayer(e);o.addLayer(c);o.addEventCallback("MouseDragDelta",l);o.addEventCallback("NodePropsChanged",a);o.addDeltaMeasuring(2,n);o.runtime.InvalidateTextlayer=false;o.aabb={x:23,y:44,max_x:66,max_y:88};o.setBackground=m}function b(p,o){return p+Math.floor((Math.random()*(o-p)+1))}function h(){this.invalidateLayer(e);this.invalidateLayer(c)}function a(){this.update()}function m(p,o){if(typeof p!="undefined"){this.options.view.dbg.backgroundColor1=p}if(typeof o!="undefined"){this.options.view.dbg.backgroundColor2=o}this.invalidateLayer(d);this.update()}function k(o){o.SetShadow();o.context.lineWidth=1;o.context.strokeStyle="#aaFaFa";o.context.strokeRect(o.aabb.x+0.5-2,o.aabb.y+0.5-2,o.aabb.max_x-o.aabb.x+2,o.aabb.max_y-o.aabb.y+2)}function n(){this.runtime.InvalidateTextlayer=true}function g(){if(this.hasLayerData(d)){this.setLayer();this.Clear();this.SetShadow();this.drawLayer(d)}else{this.setLayer(d);this.dbgview={};this.dbgview.gradientBackground=this.context.createRadialGradient(280,320,0,300,300,500);this.dbgview.gradientBackground.addColorStop(0,this.options.view.dbg.backgroundColor1);this.dbgview.gradientBackground.addColorStop(1,this.options.view.dbg.backgroundColor2);this.context.fillStyle=this.dbgview.gradientBackground;this.context.fillRect(0,0,this.bounds.width,this.bounds.height);this.saveLayer();this.setLayer();this.drawLayer(d)}this.context.font="8pt Verdana";this.setLayer();this.SetShadow();this.context.fillStyle="rgb(255, 255, 255)";var w=false;if(this.runtime.separateWith>=0){w=true}this.aabb={x:16777215,y:16777215,max_x:-16777215,max_y:-16777215};this.context.fillText(this.fps.rate.toFixed(2)+" fps",14,14);this.setLayer(j);this.Clear();this.context.translate(this.objs_translate.xoffset,this.objs_translate.yoffset);this.SetShadow();this.context.fillStyle="rgb(255, 255, 255)";for(var A=0;A<this.conIndexes.length;A++){var v=0;var F=0;var u=0;var D=0;v=this.objects[this.conIndexes[A][0]].x;F=this.objects[this.conIndexes[A][0]].y;u=this.objects[this.conIndexes[A][1]].x;D=this.objects[this.conIndexes[A][1]].y;var p=4;var B=this.options.view.node.radius;var t=u-v;var s=D-F;var H=Math.sqrt(Math.pow(t,2)+Math.pow(s,2));var C=B/H;var r=u-(C*t);var q=D-(C*s);var v=v+(C*t);var F=F+(C*s);if(w){if(this.runtime.separateWith==this.conIndexes[A][0]||this.runtime.separateWith==this.conIndexes[A][1]){this.context.fillStyle=this.context.strokeStyle="#FFFFFF"}else{this.context.fillStyle=this.context.strokeStyle="#aaaaaa"}}else{this.context.strokeStyle="#FFFFFF"}this.drawArrow(v,F,r,q,3,1,Math.PI/4,p)}this.context.lineWidth=1;this.context.strokeStyle="#FFFFFF";for(var A=0;A<this.objects.length;A++){if(this.editTextNode===A){this.context.fillStyle="rgba(255, 187, 40, 0.8)";this.context.strokeStyle="rgb(255, 187, 40)";this.context.beginPath();this.context.moveTo(this.objects[A].x+0.5,this.objects[A].y+0.5);this.context.lineTo(this.EditPanel.x-this.objs_translate.xoffset,this.EditPanel.y-this.objs_translate.yoffset);this.context.closePath();this.context.fill();this.context.stroke();this.context.strokeStyle="#FFFFFF"}else{if(this.selectedNode===A){this.context.fillStyle="rgba(68, 110, 150, 0.6)"}else{this.context.fillStyle="rgba(0, 0, 0, 0.2)"}}this.context.beginPath();this.context.arc(this.objects[A].x,this.objects[A].y,this.options.view.node.radius,0,2*Math.PI,false);this.context.closePath();this.context.fill();this.context.stroke();this.NodeDisposition(this.objects[A])}this.context.translate(-this.objs_translate.xoffset,-this.objs_translate.yoffset);this.saveLayer();this.setLayer();this.SetShadow();this.drawLayer(j);this.runtime.InvalidateTextlayer=false;this.setLayer(e);this.Clear();this.context.font="9pt Verdana";this.SetShadow();this.context.translate(this.objs_translate.xoffset,this.objs_translate.yoffset);this.context.fillStyle="rgb(255, 255, 255)";for(var A=0;A<this.objects.length;A++){if(this.objects[A].label!==undefined){var z=this.context.measureText(this.objects[A].label);var G=this.objects[A].x-this.options.view.node.radius-z.width-4;var E=this.objects[A].y+this.options.view.node.radius*0.5;this.context.fillStyle="rgba(255, 255, 255, 0.1)";this.context.fillRect(G,E-10,z.width,12);this.context.fillStyle="rgb(255, 255, 255)";this.context.fillText(this.objects[A].label,G,E);this.AABBboundsUpdate(G,G+z.width,E,E+12)}if(this.objects[A].labelRight!==undefined){var o=this.objects[A].labelRight;o=o.length>21?o.substr(0,18)+"...":o;var z=this.context.measureText(o);var G=this.objects[A].x+this.options.view.node.radius+4;var E=this.objects[A].y+this.options.view.node.radius*0.5;this.context.fillStyle="rgba(255, 255, 255, 0.1)";this.context.fillRect(G,E-10,z.width,12);this.context.fillStyle="rgb(255, 255, 255)";this.context.fillText(o,G,E);this.AABBboundsUpdate(G,G+z.width,E-10,E+12)}}this.context.translate(-this.objs_translate.xoffset,-this.objs_translate.yoffset);k(this);this.saveLayer();if(this.runtime.temporaryConnection){index=this.runtime.connectFrom;v=this.objects[index].x;F=this.objects[index].y;u=this.runtime.mx-this.objs_translate.xoffset;D=this.runtime.my-this.objs_translate.yoffset;var p=4;var B=this.options.view.node.radius;var t=u-v;var s=D-F;var H=Math.sqrt(Math.pow(t,2)+Math.pow(s,2));var C=B/H;var r=u-(C*t);var q=D-(C*s);var v=v+(C*t);var F=F+(C*s);this.setLayer();this.SetShadow();this.context.translate(this.objs_translate.xoffset,this.objs_translate.yoffset);this.context.fillStyle="#aaaaaa";this.context.strokeStyle="#aaaaaa";this.drawArrow(v,F,r,q,3,1,Math.PI/4,p);this.context.translate(-this.objs_translate.xoffset,-this.objs_translate.yoffset)}if(!this.hasLayerData(c)){this.setLayer(c);this.Clear();this.RenderMenu(c,c);this.RenderProxyPanels();this.saveLayer()}this.setLayer();this.SetShadow();this.drawLayer(e);this.drawLayer(c)}function l(o,p){}truss_o.extendModule(f,"view.Debug",["view.Interface","view.Layers","objects.Tree","view.Structure","core.runtime","view.Menu","extBlur"])}());